---
title: TS ç¼–ç¨‹æ–¹æ³•ä»‹ç»
date: 2022-08-29 20:20:47
categories:
- TypeScript
comments: true
---

## åŸºç¡€æ¦‚å¿µ

### åŸºç¡€ç±»å‹

- any
  - ä¸€åˆ‡çš†å¯ anyï¼Œä¹Ÿè¢«ç§°ä¸ºç±»å‹é€ƒç”Ÿèˆ±ï¼Œanyscript çš„æ¥æº
- unknown
  - æœªçŸ¥ç±»å‹ï¼Œä¸ªäººæ¨èå°½é‡ä½¿ç”¨ unknown æ¥ä»£æ›¿ any
- void | null | undefined
  - voidï¼šç©ºç±»å‹
    - åªèƒ½å°†å®ƒèµ‹å€¼ä¸º `undefined` å’Œ `null`
  - nullã€undefinedï¼šå®šä¹‰ä¸¤ä¸ªåŸå§‹æ•°æ®ç±»å‹
    - ä¸ `void` çš„åŒºåˆ«æ˜¯ï¼Œ`undefined` å’Œ `null` æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹
- never
  - ä¸€èˆ¬ç”¨äºè¡¨ç¤ºä»£ç ä¼šå´©æºƒï¼ˆå¦‚ throw Errorï¼‰é€€å‡ºã€é™·å…¥æ­»å¾ªç¯
  - `never` ä»…èƒ½è¢«èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ª `never` ç±»å‹
- number | boolean | ...
  - JS å€¼ç±»å‹éƒ½æ˜¯æœ‰æ•ˆçš„ç±»å‹



### æ³›å‹

ç®€å•æ¥è®²ï¼Œæ³›å‹å¯ä»¥è¢«ç†è§£æˆä¸€ä¸ªå½¢å¼ä¸Šçš„ç±»å‹å ä½ç¬¦ï¼Œå…·ä½“ç±»å‹å°†åœ¨ä¼ å…¥å®å‚æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç»™è¿™ä¸ªç±»å‹å ä½ç¬¦å¢åŠ ç›¸å…³ç±»å‹çº¦æŸã€‚

å¸¸è§çš„æ³›å‹å®šä¹‰å¦‚ä¸‹ï¼š

```JavaScript
// 1. å‡½æ•°å®šä¹‰
function test<T, P>(prams: P): T {
  
}

// 2. ç±»å‹å®šä¹‰
type TObject<V> = Record<string, V>;

// 3. class
class LRU<T extends any>{}
```

ä¸¾ä¸€ä¸ªæ¯”è¾ƒæµ…æ˜¾çš„ä¾‹å­ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªè¯·æ±‚åç«¯æ¥å£çš„æ–¹æ³•ï¼š

```JavaScript
const request = (url: string, params: Record<string, unknown>): SomeAPIResponse => {
  // fetch or axios
}
```

é€šå¸¸æ¥è®²ï¼Œåç«¯è¿”å›çš„æ•°æ®ç»“æ„æ˜¯å¤šç§å¤šæ ·çš„ï¼Œä»¥å¾€æˆ‘ä»¬å®šä¹‰å‡½æ•°ç±»å‹çš„æ–¹æ³•å°±æ˜¯ç›´æ¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç±»å‹ï¼ˆå¦‚ä¸Šé¢çš„ä»£ç ï¼‰ï¼Œè¿™æ ·æœ‰éå¸¸å¤§çš„å±€é™æ€§ï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€éœ€è¦å¼€å‘è€…ç»™æ¯ä¸€ä¸ª API è¯·æ±‚éƒ½å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰èƒ½äº«å—åˆ° IDE çš„ä»£ç æç¤ºï¼Œæ¯”å¦‚ï¼š

```JavaScript
const requestAAPI = (url: string, params: Record<string, unknown>): AAPIResponse => {
  // fetch or axios
}

const requestBAPI = (url: string, params: Record<string, unknown>): BSomeAPIResponse => {
  // fetch or axios
}
```

è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ³›å‹å°±æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå½¢å¼ä¸Šçš„ç±»å‹å ä½ç¬¦ Tï¼ˆæˆ–è€…åˆ«çš„ä»€ä¹ˆå­—ç¬¦ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯å¤§å†™ï¼‰ï¼Œäº¤ç”±ç±»å‹ç³»ç»Ÿåœ¨ä½¿ç”¨æ—¶ç¡®å®šå…·ä½“çš„ç±»å‹ã€‚

```JavaScript
const request = <T>(url: string, params: Record<string, unknown>): T => {
  // fetch or axios
}
const result = request<{ data: Record<string, string> }>('/test', { a: 1 })
```



### åˆ†æ”¯é€»è¾‘

ç›®å‰ Typescript ä½¿ç”¨çš„åˆ†æ”¯é€»è¾‘åªæœ‰ä¸€ç§ï¼Œå³ä¸‰å…ƒè¡¨è¾¾å¼ï¼Œä¸€èˆ¬ä½¿ç”¨å¦‚ä¸‹ï¼š

```JavaScript
/**- Exclude null and undefined from T
*/

type NonNullable<T> = T extends null | undefined ? never : T;
```

ä»¥ä¸Šé€»è¾‘å¯ä»¥ç®€å•ç†è§£ä¸ºç±»å‹ T èƒ½å¤Ÿè¢« null æˆ–è€… undefined çº¦æŸæ—¶è¿”å› never ç±»å‹ï¼Œå¦åˆ™è¿”å›ç±»å‹ T



### Infer

ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨ç±»å‹ç¼–ç¨‹ä¸­ä¼šä½¿ç”¨ infer æ¥åšå˜é‡å®šä¹‰ã€‚ç®€å•ç†è§£ä¸‹æ¥å°±æ˜¯ï¼Œå¯¹äºéœ€è¦æ¨æ–­çš„ç±»å‹éƒ½å¯ä»¥é€šè¿‡ infer æ¥å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç»“åˆä¸‰å…ƒè¿ç®—ç¬¦å¯ä»¥æ¨æ–­å‡ºå…·ä½“çš„ç±»å‹ï¼Œæ¯”å¦‚ä»¥ä¸‹ ğŸŒ°ï¼š

```JavaScript
type TMyPromise = Promise<string>;
type PromiseOf<T> = T extends Promise<infer P> ? P : unknown;
type result = PromiseOf<TMyPromise> // å°†è¢«æ¨å¯¼ä¸º string
```

å¯ä»¥å°† infer P ç†è§£ä¸ºå˜é‡ Pï¼Œå½“ç±»å‹ T èƒ½å¤Ÿè¢« Promise<infer P> çº¦æŸæ—¶ï¼Œå³è¿”å›å½“å‰å˜é‡ P çœŸå®çš„ç±»å‹ï¼Œå¦åˆ™è¿”å› unknownã€‚



### Utility Types

Typescript æœ¬èº«æä¾›äº†ä¸€äº›è‡ªå¸¦çš„å·¥å…·ç±»å‹ï¼Œæ¯”å¦‚ Recordã€Parametersã€Excludeã€Partial ç­‰ç­‰ï¼Œè¿™äº›åŸºç¡€å·¥å…·ç±»å‹ï¼ˆå…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºå‡½æ•°ï¼‰å¯ä»¥æ›´å¥½çš„å¸®åŠ©æˆ‘ä»¬åšä¸€äº›åŸºç¡€çš„ç±»å‹ç¼–ç¨‹ï¼Œå½“ç„¶å¦‚æœè¿˜æ²¡æœ‰æ¥è§¦è¿‡è¿™äº›åŸºç¡€çš„ Utility Typesï¼Œå¯ä»¥å»å®˜ç½‘äº†è§£ä¸€ä¸‹ï¼šhttps://www.typescriptlang.org/docs/handbook/utility-types.html



## åº”ç”¨åœºæ™¯

### å‡½æ•°ç±»å‹é€ä¼ 

åœ¨å®é™…çš„å·¥ä½œåœºæ™¯ä¸­ï¼Œä¸ºäº†è¿½æ±‚æ€§èƒ½å¸¸å¸¸ä¼šç”¨ç©ºé—´æ¢æ—¶é—´çš„åšæ³•æ¥å®ç°ä¸€ä¸ªç¼“å­˜å‡½æ•°ï¼Œä¸€èˆ¬æŠ½è±¡å¦‚ä¸‹ã€‚

```JavaScript
const cache = (expensiveFn) => {
  // do something before
  return (...args) => {
    // do anythings
    return expensiveFn(...args);
  }
}

const c = cache(anyFunc) // typeof c ==> typeof anyFunc
```

åœ¨ä»¥ä¸Šä»£ç åœºæ™¯ä¸­ï¼ŒIDE çš„ç±»å‹æ¨å¯¼åªä¼šé»˜è®¤æ¨æ–­ c çš„ç±»å‹ä¸º `(...args: any[]) => any`ï¼Œæ˜¾ç„¶è¿™å’Œæˆ‘ä»¬çš„é¢„æœŸä¸ç¬¦ï¼Œæˆ‘ä»¬å¸Œæœ› c çš„ç±»å‹èƒ½å¤Ÿä¸å…¥å‚ä¸­çš„å‡½æ•°ç±»å‹ä¿æŒä¸€è‡´ï¼Œè¿™æ ·æ–¹ä¾¿æä¾›è¶³å¤Ÿçš„ä»£ç æç¤ºï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

ç»“åˆ Typescript å†…ç½®çš„ Parameters å’Œ ReturnTypeï¼Œå¯ä»¥å¾ˆå¿«çš„å®ç°ä»¥ä¸Šç±»å‹æ¨å¯¼ï¼š

```JavaScript
type AnyFunc = (...args: any[]) => any;
const cache = <T extends AnyFunc>(expensiveFn: T) => {
  // do something
  return (...args: Parameters<T>): ReturnType<T> => {
      // do anythings
    return expensiveFn(...args);
  }
}

// ç¨å¾®æŠ½è±¡ä¸€ä¸‹
type TWrapFn = <T extends AnyFunc>(fn: T) => (...args: Parameters<T>) => ReturnType<T>

const cache: TWrapFn = (fn) => {
  // do something before
  return (...args) => {
    return fn(...args);
  }
}
```



### æ•°ç»„ç±»å‹æ¨æ–­

å¾ˆå¤šåŒå­¦åº”è¯¥éƒ½é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯å‘ç°æ¨æ–­çš„ä¸æ˜¯å¯¹åº”çš„å€¼ç±»å‹ï¼Œä»è€Œå¯¼è‡´åœ¨ä½¿ç”¨æ—¶æ²¡æœ‰é™åˆ¶ä½ç±»å‹ã€‚æ¯”å¦‚ï¼š

```JavaScript
const characters = ['A', 'B', 'C'];
type TCharacters = typeof characters // ç±»å‹æ¨æ–­ä¸º string[]
```

ä¸€èˆ¬çš„è§£æ³•å°±æ˜¯æ‰‹åŠ¨ç»™ characters å®šä¹‰å¥½ç±»å‹ï¼Œä¾‹å¦‚ï¼š

```JavaScript
type TCharacter = 'A' | 'B' | 'C';
const characters: TCharacter[] = ['A', 'B', 'C'];
```

å¦ä¸€ç§è§£æ³•åˆ™æ˜¯åˆ©ç”¨`as const`ï¼Œå°†å­—ç¬¦ä¸²å­—é¢é‡æ¨æ–­å¸¸é‡ï¼š

```JavaScript
const characters = ['A' as const, 'B' as const, 'C' as const];
type TCharacters = typeof characters // ç±»å‹æ¨æ–­ä¸º 'A'|'B'|'C'[]
```



### é©¼å³°è½¬æ¢

è¿™ä¸ªåœºæ™¯ä¸€èˆ¬å‡ºç°åœ¨ä¸ç¬¬ä¸‰æ–¹æ•°æ®å‘ç”Ÿäº¤äº’æ—¶ï¼Œç¬¬ä¸‰æ–¹æ•°æ®ï¼ˆå¦‚åç«¯ï¼‰å¯èƒ½å®šä¹‰çš„ç±»å‹ä¸ºå¤§é©¼å³°ï¼Œè€Œå‰ç«¯çš„å®ç°ä¸€èˆ¬æ˜¯å°é©¼å³°ï¼Œä¸ºäº†è§£å†³ç±»å‹ä¸Šçš„å·®å¼‚ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä¸ªè½¬æ¢å‡½æ•°æ¥æŠ¹å¹³æ•°æ®å·®å¼‚ã€‚æ¯”å¦‚ï¼š

```JavaScript
const pascal2Camel = (data) => {
  const result = {};
  Object.keys(data).forEach(k => {
    const value = data[k];
    result[camelcase(k)] = value;
  }));
  return result;
}
```

è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä¿ç•™ç±»å‹ä¿¡æ¯å‘¢ï¼Ÿåˆ©ç”¨ Utility Types ä¸­çš„ Uncapitalizeï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

```JavaScript
type Result = {
  NameEn: string;
}

type toCamelCase<T> = T extends string
  ? T extends `${infer A}${infer B}`
    ? `${Uncapitalize<A>}${B}`
    : T
  : T;

type CamelCase<T> = {
  [K in keyof T as toCamelCase<K>]: T[K];
};

type R = CamelCase<Result>; // type R = { nameEn: string }
```



### XOR

æŸäº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¼šç»™æŸä¸ªå˜é‡å®šä¹‰ä¸¤ç§ç±»å‹ï¼Œé€šå¸¸æ˜¯è¿™æ ·ï¼š

```JavaScript
type Person = { name: string; } | { firstname: string; lastname: string; };

const p1: Person = { name: "Foo", firstname: 'a' };
const p2: Person = { firstname: "Foo", lastname: "Bar" } ;
```

é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬æœŸæœ› p1 å’Œ p2 çš„å±æ€§äº’ä¸å¹²æ‰°ï¼Œä½†å®é™…ä¸Šä»¥ä¸‹å®šä¹‰ä¹Ÿæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚

```JavaScript
const bad1: Person = { name: "Foo", lastname: "Bar" }
const bad2: Person = { firstname: "Bar", name: "Foo" }
```

ä¸€èˆ¬æˆ‘ä»¬ç§°è¿™æ ·çš„è¿ç®—ä¸º XOR ï¼ˆå¼‚æˆ–ï¼‰ï¼Œåªè¦ä¸¤è€…å®Œå…¨ä¸åŒæ—¶è¿”å› trueã€‚å¯¹åº”åˆ°ç±»å‹ä¸Šæ¥è®²ï¼Œæˆ‘ä»¬æ€æ ·å»å®ç°ä¸€ä¸ª XOR è¿ç®—ç¬¦å‘¢ï¼Ÿå®é™…ä¸Šä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç»“åˆ Exclude å’Œ never å¯ä»¥å®ç°å¦‚ä¸‹ï¼š

```JavaScript
/**
 * Exclude from T those types that are assignable to U
 */
type Exclude<T, U> = T extends U ? never : T;

// å–å‡º T ä¸­ä¸ U ä¸åŒçš„å±æ€§ï¼Œå¹¶è®¾ç½®ä¸º neverï¼›é€šè¿‡ never & any = never çš„æ€§è´¨ï¼Œæ¥å»é™¤åŒå±æ€§
type Without<T, U> = {
  [K in Exclude<keyof T, keyof U>]?: never
};

export type XOR<T, U> = T | U extends object ? (Without<T, U> & U) | (Without<U, T> & T) : T | U;

// ä½¿ç”¨
type Person = XOR<{ name: string; }, { firstname: string; lastname: string; }>
```



### Promise è¿”å›ç±»å‹

```JavaScript
type PromiseResType<T> = T extends Promise<infer R> ? R : T
```

- `T extends U ? X : Y`çš„å½¢å¼ä¸ºæ¡ä»¶ç±»å‹ã€‚
- `infer R` ä»£è¡¨å¾…æ¨æ–­çš„è¿”å›å€¼ç±»å‹ï¼Œå¦‚æœ `T` æ˜¯ä¸€ä¸ªPromiseå‡½æ•°`Promise<infer R>` ï¼Œåˆ™è¿”å›å‡½æ•°çš„è¿”å›å€¼ `R`ï¼Œå¦åˆ™è¿”å›`any`ã€‚

```JavaScript
async function strPromise() {
  return 'string promise'
}

type StrPromise = ReturnType<typeof strPromise> // Promise<string>
type StrPromiseRes = PromiseResType<StrPromise> // str
```



## ç±»å‹æŒ‘æˆ˜

> ç±»å‹ä½“æ“è®­ç»ƒè¥ ğŸ’ª

https://github.com/type-challenges/type-challenges