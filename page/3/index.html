<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="Dream high">
<meta property="og:type" content="website">
<meta property="og:title" content="ZhangWei2222">
<meta property="og:url" content="http://super-wei.xyz/page/3/index.html">
<meta property="og:site_name" content="ZhangWei2222">
<meta property="og:description" content="Dream high">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZhangWei2222">
<meta name="twitter:description" content="Dream high">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://super-wei.xyz/page/3/"/>





  <title>ZhangWei2222</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ZhangWei2222</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/cartcontrol-vue购物车操作按钮/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/cartcontrol-vue购物车操作按钮/" itemprop="url">cartcontrol.vue购物车操作按钮</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:54:07+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="html代码"><a href="#html代码" class="headerlink" title="html代码"></a>html代码</h2><p>知识点:</p>
<ul>
<li>使用了vue2的动画实现方式-transition,这里主要在css上设计来配合vue2</li>
</ul>
<ul>
<li>cartcontrol这个模块主要通过三个小模块实现,删除按钮,显示数量块,增加按钮</li>
</ul>
<ul>
<li><p>删除按钮和增加按钮都带有一个click方法,并且都有v-show来根据food的数量来控制显示,而显示数量块就只是单纯显示food的数量</p>
  <template><br>    <div class="cartcontrol"><br>    <!--外层动画--><br>      <transition name="move"><br>        <div class="cart-decrease" v-show="food.count>0" @click="decreaseCart"><br>        <!--内层动画--><br>          <span class="inner icon-remove_circle_outline"></span><br>        </div><br>      </transition><br>      <div class="cart-count" v-show="food.count>0"></div><br>      <div class="cart-add icon-add_circle" @click="addCart"></div><br>    </div><br>  </template>

</li>
</ul>
<h2 id="js代码"><a href="#js代码" class="headerlink" title="js代码"></a>js代码</h2><p>知识点:</p>
<ul>
<li>引入vue模块,因为需要使用Vue.set方法</li>
</ul>
<ul>
<li>接收来自goods.vue的food数据,然后使用</li>
</ul>
<ul>
<li>有2个方法,一个是addCart,一个是decreaseCart,分别对应html代码中的@click</li>
</ul>
<ul>
<li>addCart方法,默认会传入event原生dom事件</li>
</ul>
<pre><code>- 鉴于bsscrol插件的原因,需要return掉非bscrol的事件


- 需要注意的是这里的food并没有count属性,所需要手动设置,虽然之前goods会将有count属性的food做自动处理,但是最开始的时候,所有food都没有count属性,并且cartcontrol是最开始触发对food的count属性进行添加的(点击一次就会对count++,增加一个food)


- food数据是从父组件goods.vue传入的,所以对这个数据的修改,也能够反应到父组件,而这里使用Vue.set直接对vue的data进行对象数据写入,对food数据添加了一个count的属性,用来控制每一个food的被选中的数量,也因为shopcart.vue的数据也是从父组件goods.vue传入的,使用同一个food数据,从而关联到[shopcart.vue购物车]()的food的购买数量统计
</code></pre><ul>
<li><p>decreaseCart方法,同上</p>
<pre><code>&lt;script&gt;
  import Vue from &apos;vue&apos;;

  export default{
    props: {
      food: {
        type: Object
      }
    },
    methods: {
      addCart(event){
        if (!event._constructed) {
          return false;
        }
        if (!this.food.count) {
          Vue.set(this.food, &apos;count&apos;, 1); //遇到没有这个属性的,会强行添加一个
        } else {
          this.food.count++; 
        }
        this.$emit(&apos;add&apos;, event.target);
      },
      decreaseCart(event){
        if (!event._constructed) {
          return false;
        }
        if (this.food.count) {
          this.food.count--;
        }
      }
    }
  };
&lt;/script&gt;
</code></pre></li>
</ul>
<h2 id="css代码"><a href="#css代码" class="headerlink" title="css代码"></a>css代码</h2><p>知识点:</p>
<ul>
<li>vue2的动画</li>
</ul>
<ul>
<li>Vue 提供了 transition 的封装组件,就是之前的<transition></transition></li>
</ul>
<ul>
<li>这个动画是一个滚动淡入和淡出的效果</li>
</ul>
<ul>
<li>首先,定义了这个动画效果的名字为move(<transition name="move">),并且将需要这个效果的内容用一个dom的div包裹起来,这个效果分2层,外层和内层inner(外层和内层用class来区分,通过增加一个内层class inner来区分)</transition></li>
</ul>
<ul>
<li>然后,设置原始的动画状态(外层和内层)</li>
</ul>
<pre><code>- 外层设置了透明度为1和transform变形的3d位置


- 内层设置了滚动角度和淡入淡出效果
</code></pre><ul>
<li>然后,设置vue的动画过渡属性</li>
</ul>
<pre><code>- move-enter-active和move-leave-active


    - 这里设置匀速过渡效果是为了在动画进入过渡的结束状态和动画离开过渡的结束状态都是匀速过渡的变化效果,至于变化成什么效果需要看move-enter和move-leave-active


- move-enter和move-leave-active


    - 这里设置外层的透明度为0(内层会继承)和变形的3d位置


    - 这里设置了内层滚动角度


    - 这么做实现了动画在进入过渡后和离开过渡后都会内外层,并且会出现内层一边滚动到指定位置然后消失的效果
</code></pre><ul>
<li>font-size的使用</li>
</ul>
<pre><code>- 因为使用行内元素,所以需要通过设置font-size为0来取消间隙
</code></pre><ul>
<li><p>对于一些设计上的图标过小(操作区域太小)影响用户操作体验的情况,需要增加一个padding来实现增大操作区域的目的</p>
<pre><code>&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;
  .cartcontrol
    font-size: 0
    .cart-decrease //外层动画原始状态
      display: inline-block
      padding: 6px
      opacity: 1 
      transform: translate3d(0, 0, 0) 
      .inner //内层动画原始状态
        display: inline-block
        line-height: 24px
        font-size: 24px
        color: rgb(0, 160, 220)
        transition: all 0.4s linear 
        transform: rotate(0)
      &amp;.move-enter-active, &amp;.move-leave-active //vue动画过渡属性     
        transition: all 0.4s linear
      &amp;.move-enter, &amp;.move-leave-active //vue动画过渡属性
        opacity: 0
        transform: translate3d(24px, 0, 0)
        .inner
          transform: rotate(180deg)
    .cart-count
      display: inline-block
      vertical-align: top
      width: 12px
      padding-top: 6px
      line-height: 24px
      text-align: center
      font-size: 10px
      color: rgb(147, 153, 159)
    .cart-add
      display: inline-block
      padding: 6px
      line-height: 24px
      font-size: 24px
      color: rgb(0, 160, 220)
&lt;/style&gt;    
</code></pre></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/商品区域goods-vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/商品区域goods-vue/" itemprop="url">商品区域goods.vue</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:53:45+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="技术点"><a href="#技术点" class="headerlink" title="技术点:"></a>技术点:</h2><ul>
<li>定义了2个wrapper,分别是menu-wrapper和foods-wrapper,对应当前页面的架构,左右两边的区域</li>
</ul>
<ul>
<li>v-if和v-show的选择使用</li>
</ul>
<ul>
<li><p>v-for传递索引</p>
</li>
<li><p>vue传递原生事件$event</p>
</li>
<li><p>使用stylus的mixin处理一些border和img的问题</p>
</li>
<li><p>建立menu区域和foods区域的Y坐标对应关系,实现滚动foods区域会显示相应的menu区域,点击某个menu区域就显示某个固定的foods区域</p>
</li>
<li><p>flex布局的使用,实现foods区域的布局</p>
</li>
<li><p>技巧类:对一些需要js操作的class(但是又没有实际用途的)可以建立一个类似food-list-hook钩子类</p>
</li>
<li><p>font-size为0的技术点,处理行内元素的间隙问题</p>
</li>
<li><p>vue的$nextTick使用</p>
</li>
<li><p>vue的$refs的使用</p>
</li>
<li><p>vue的computed属性使用</p>
</li>
<li><p>vue的class绑定使用</p>
</li>
<li><p>在一些地方里面,使用table的垂直居中会很简单实现垂直居中</p>
</li>
<li><p>better-scroll的使用</p>
</li>
</ul>
<p><img src="http://oncweb6po.bkt.clouddn.com/2116342489-590b01d4d9952_articlex.png" alt=""></p>
<h2 id="html代码"><a href="#html代码" class="headerlink" title="html代码"></a>html代码</h2><pre><code>&lt;template&gt;
  &lt;div class=&quot;goods&quot;&gt;
  //第一个区域,menu区域
    &lt;div class=&quot;menu-wrapper&quot; ref=&quot;menuWrapper&quot;&gt;
      &lt;ul&gt;
      //v-for的使用,class绑定,传递原生事件
        &lt;li v-for=&quot;(item,index) in goods&quot; class=&quot;menu-item&quot; :class=&quot;{&apos;current&apos;:currentIndex === index}&quot;
            @click=&quot;selectMenu(index,$event)&quot;&gt;
          &lt;span class=&quot;text border-1px&quot;&gt;
          &lt;!--v-show使用--&gt;
            &lt;span v-show=&quot;item.type&gt;0&quot; class=&quot;icon&quot; :class=&quot;classMap[item.type]&quot;&gt;&lt;/span&gt;{{item.name}}
          &lt;/span&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
    //第二个区域 food区域
    //$refs的使用
    &lt;div class=&quot;foods-wrapper&quot; ref=&quot;foodsWrapper&quot;&gt;
      &lt;ul&gt;
      //hook钩子类的使用(food-list-hook)
        &lt;li v-for=&quot;item in goods&quot; class=&quot;food-list food-list-hook&quot;&gt;
          &lt;h1 class=&quot;title&quot;&gt;{{item.name}}&lt;/h1&gt;
          &lt;ul&gt;
            &lt;li v-for=&quot;food in item.foods&quot; class=&quot;food-item&quot;&gt;
              &lt;div class=&quot;icon&quot;&gt;
                &lt;img width=&quot;57&quot; height=&quot;57&quot; :src=&quot;food.icon&quot;&gt;
              &lt;/div&gt;
              &lt;div class=&quot;content&quot;&gt;
                &lt;h2 class=&quot;name&quot;&gt;{{food.name}}&lt;/h2&gt;
                &lt;p class=&quot;desc&quot;&gt;{{food.description}}&lt;/p&gt;
                &lt;div class=&quot;extra&quot;&gt;
                  &lt;span class=&quot;count&quot;&gt;月售{{food.sellCount}}份&lt;/span&gt;&lt;span&gt;好评率{{food.rating}}%&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class=&quot;price&quot;&gt;
                  &lt;span class=&quot;now&quot;&gt;¥{{food.price}}&lt;/span&gt;&lt;span class=&quot;old&quot;
                                                                v-show=&quot;food.oldPrice&quot;&gt;¥{{food.price}}&lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
    //第三个区域,shopcart区域
    &lt;shopcart ref=&quot;shopcart&quot; :selectFoods=&quot;selectFoods&quot; :deliveryPrice=&quot;seller.deliveryPrice&quot;
              :minPrice=&quot;seller.minPrice&quot;&gt;&lt;/shopcart&gt;
    //第四个区域,隐藏的食物详情区域
    &lt;food @add=&quot;addFood&quot; :food=&quot;selectedFood&quot; ref=&quot;food&quot;&gt;&lt;/food&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><p>备注:</p>
<ul>
<li>v-for使用已经很常见了,不过这里需要了解,vue1和2有区别,现在是用vue2,所以index变量传递会变成现在这种模式(item,index) in goods</li>
</ul>
<ul>
<li>vue传递原生事件使用$event</li>
</ul>
<ul>
<li>:class=”{‘current’:currentIndex === index}”是vue的绑定class的使用方法,通过绑定一个class变量来直接操作,并且这里的逻辑会跟js代码里面对应<br>通过currentIndex和index做对比,来确认是否添加current类,他们之间的对比关系也就是menu区域和foods区域的显示区域的对比关系<br>通过添加current类来实现当前页面的区域的样式变化<br>currentIndex是一个计算属性,可以随时变化并且直接反应到dom上(看js里面逻辑)</li>
</ul>
<ul>
<li>v-show和v-if的区别官网已经说过<ol>
<li>v-if 是“真正的”条件渲染，因为它会确保在切换过程中条件块内的事件监听器和子组件适当地被销毁和重建。</li>
<li>v-if 也是惰性的：如果在初始渲染时条件为假，则什么也不做——直到条件第一次变为真时，才会开始渲染条件块。</li>
</ol>
</li>
</ul>
<p>一般来说， v-if 有更高的切换开销，而 v-show 有更高的初始渲染开销。因此，如果需要非常频繁地切换，则使用 v-show 较好；如果在运行时条件不太可能改变，则使用 v-if 较好。</p>
<ul>
<li>$refs的使用是vue操作dom的一种方式:</li>
</ul>
<pre><code>- ref 被用来给元素或子组件注册引用信息。引用信息将会注册在父组件的 $refs 对象上。


- 如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素; 如果用在子组件上，引用就指向组件实例:
</code></pre><ul>
<li>hook钩子类的使用,需要结合js里面的语法来看,这个类只是用来操作,不会产生dom的渲染,方便js控制清晰.</li>
</ul>
<h2 id="js代码"><a href="#js代码" class="headerlink" title="js代码"></a>js代码</h2><pre><code>&lt;script&gt;
  import BScroll from &apos;better-scroll&apos;; //导入better-scroll
  import shopcart from &apos;../../components/shopcart/shopcart&apos;;//导入shopcart购物车组件
  import cartcontrol from &apos;../../components/cartcontrol/cartcontrol&apos;; //导入购物组件
  import food from &apos;../../components/food/food&apos;; //导入食物详情组件

  const ERR_OK = 0; //常量,方便解耦

  export default {
    props: {
      seller: {
        type: Object
      }
    },
    data(){
      return {
        goods: [],
        listHeight: [], //用来储存foods区域的各个区块的高度(clientHeight)
        scrollY: 0 //用来存储foods区域的滚动的Y坐标
        selectedFood: {} //用来存储当前已被选择的food数据,对象保存形式
      }
    },
    computed: {
      currentIndex(){ //计算到达哪个区域的区间的时候的对应的索引值
        for (let i = 0; i &lt; this.listHeight.length; i++) {
          let height1 = this.listHeight[i]; //当前menu子块的高度
          let height2 = this.listHeight[i + 1]; //下一个menu子块的高度
          //滚动到底部的时候,height2为undefined,需要考虑这种情况
          //需要确定是在两个menu子块的高度区间
          if (!height2 || (this.scrollY &gt;= height1 &amp;&amp; this.scrollY &lt; height2)) {
            return i; //返回这个menu子块的索引
          }
        }
        return 0;
      },
      selectFoods() { //自动将所有的goods.food添加一个count属性,方便做数量运算
        let foods = [];
        this.goods.forEach((good) =&gt; {
          good.foods.forEach((food) =&gt; {
            if (food.count) {
              foods.push(food);
            }
          });
        });
        return foods;
      }
    },
    created(){
      this.classMap = [&apos;decrease&apos;, &apos;discount&apos;, &apos;special&apos;, &apos;invoice&apos;, &apos;guarantee&apos;];

      this.$http.get(&apos;/api/goods&apos;).then((response) =&gt; {
        response = response.body;
        if (response.errno === ERR_OK) {
          this.goods = response.data;
          this.$nextTick(() =&gt; { //使用$nextTick来等待异步完成之后更新dom
            this._initScroll(); //绑定滚动dom
            this._calculateHeight(); //计算foods区域的各个区域的高度
          });
        }
      });
    },
    methods: {
      selectFood(food, event){
            if (!event._constructed) {//忽略掉BScroll的事件
              return;
            }
            this.selectedFood = food; //写入当前选择的food
            this.$refs.food.show(); //显示当前选择的food的详情页
      },
      selectMenu(index, event){
        if (!event._constructed) { //忽略掉BScroll的事件
          return;
        }
        let foodsList = this.$refs.foodsWrapper.getElementsByClassName(&apos;food-list-hook&apos;);
        let el = foodsList[index];
        //类似jump to的功能,通过这个方法,跳转到指定的dom
        this.foodsScroll.scrollToElement(el, 300);
      },
      addFood(target) {
        this._drop(target);
      },
      _drop(target) {
        // 体验优化,异步执行下落动画
        this.$nextTick(() =&gt; {
          this.$refs.shopcart.drop(target); //调用shopcart的下落动画
        });
      },
      _initScroll(){
      //初始化scroll区域
        this.menuScroll = new BScroll(this.$refs.menuWrapper, {
          click: true //结合BScroll的接口使用,是否将click事件传递,默认被拦截了
        });
        this.foodsScroll = new BScroll(this.$refs.foodsWrapper, {
          probeType: 3 //结合BScroll的接口使用,3实时派发scroll事件
        });
        //结合BScroll的接口使用,监听scroll事件(实时派发的),并获取鼠标坐标
        this.foodsScroll.on(&apos;scroll&apos;, (pos) =&gt; { 
          this.scrollY = Math.abs(Math.round(pos.y));//滚动坐标会出现负的,并且是小数,所以需要处理一下
        })
      },
      //计算foods内部块的高度
      _calculateHeight(){
        let foodList = this.$refs.foodsWrapper.getElementsByClassName(&apos;food-list-hook&apos;); //获取每一个food的dom对象
        let height = 0;
        this.listHeight.push(height); //初始化第一个高度为0
        for (let i = 0; i &lt; foodList.length; i++) {
          let item = foodList[i]; //每一个item都是刚才获取的food的每一个dom
          height += item.clientHeight; //主要是为了获取每一个foods内部块的高度
          this.listHeight.push(height);
        }
      }
    },
    components: {
      shopcart,
      cartcontrol,
      food
    }
  }
&lt;/script&gt;
</code></pre><p>备注:</p>
<ul>
<li><food @add="addFood" :food="selectedFood" ref="food" \="">是通过selectFood方法写入到vue实例里面,然后传给子组件food</food></li>
</ul>
<ul>
<li>&lt;shopcart ref=”shopcart” :selectFoods=”selectFoods” 这里selectFoods被自动添加了count属性,是为了让购物车更加简单的计算已选择的food</li>
</ul>
<ul>
<li>这里最关键的是menu和food两个区域的对应处理:</li>
</ul>
<pre><code>- 在vue实例生命周期的开始created分别加载_initScroll和_calculateHeight


- 通过_calculateHeight计算foods内部每一个块的高度,组成一个数组listHeight


- 在_initScroll里面,设置了bscroll插件的一个监听事件scroll,将food区域当前的滚动到的位置的y坐标设置到一个vue实例属性scrollY this.scrollY = Math.abs(Math.round(pos.y));


- 通过计算属性currentIndex,获取到food滚动区域对应的menu区域的子块的索引,然后通过设置一个class来做样式切换变化:class=&quot;{&apos;current&apos;:currentIndex === index},实现联动


- 另外当点击menu 区域的时候,会触发selectMenu事件,也会根据点击到的menu子块的索引然后去触发food区域滚动到对应的高度区块区间this.foodsScroll.scrollToElement(el, 300);


- 这样完成整个对应.
</code></pre><ul>
<li>抛物线小球动画横跨多个vue组件(也可以说是横跨了多个DOM),整个动画会在关于购物车添加按钮的动画里面说</li>
</ul>
<ul>
<li>better-scroll需要安装,npm安装,具体参看better-scroll官网</li>
</ul>
<ul>
<li>关于在selectMenu中点击,在pc界面会出现两次事件,在移动端就只出现一次事件的问题:</li>
</ul>
<pre><code>- 原因:


- bsScrooler会监听事件(例如touchmove,click之类),并且阻止默认事件(prevent stop),并且他只会监听移动端的,pc端的没有监听


- 在pc页面上 bsScroller也派发了一次click事件,原生也派发了一次click事件

        //bsScroll的事件,有_constructed: true
        MouseEvent {isTrusted: false, _constructed: true, screenX: 0, screenY: 0, clientX: 0…}
        //pc的事件
        MouseEvent {isTrusted: true, screenX: -1867, screenY: 520, clientX: 53, clientY: 400…}    
</code></pre><ul>
<li>解决:</li>
</ul>
<pre><code>- 针对bsScroole的事件,有_constructed: true,所以做处理,return掉非bsScroll的事件
</code></pre><h2 id="css代码"><a href="#css代码" class="headerlink" title="css代码"></a>css代码</h2><pre><code>&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;
  @import &quot;../../common/stylus/mixin.styl&quot;

  .goods
    display: flex
    position: absolute //根据设计图实现,
    top: 174px //去掉header和tab的位置
    bottom: 46px //预留购物车位置
    width: 100%
    overflow: hidden
    .menu-wrapper
      flex: 0 0 80px //flex布局预留空间
      width: 80px //兼容android浏览器,不加的话会没办法预留空间
      background: #f3f5f7
      .menu-item
        display: table
        height: 54px
        width: 56px
        padding: 0 12px
        line-height: 14px
        &amp;.current
          position: relative
          z-index: 10
          margin-top: -1px
          background: #ffffff
          font-weight: 700
          .text
            border-none()
        .icon
          display: inline-block
          vertical-align: top
          width: 12px
          height: 12px
          margin-right: 2px
          background-size: 12px 12px
          background-repeat: no-repeat
          &amp;.decrease
            bg-image(&apos;decrease_3&apos;)
          &amp;.discount
            bg-image(&apos;discount_3&apos;)
          &amp;.guarantee
            bg-image(&apos;guarantee_3&apos;)
          &amp;.invoice
            bg-image(&apos;invoice_3&apos;)
          &amp;.special
            bg-image(&apos;special_3&apos;)
        .text
          display: table-cell
          width: 56px
          vertical-align: middle //table默认支持垂直居中
          border-1px(rgba(7, 17, 27, 0.1))
          font-size: 12px
    .foods-wrapper
      flex: 1
      .title
        padding-left: 14px
        height: 26px
        line-height: 26px
        border-left: 2px solid #d9dde1
        font-size: 12px
        color: rgb(147, 153, 159)
        background: #f3f5f7
      .food-item
        display: flex
        margin: 18px
        padding-bottom: 18px
        border-1px: (rgba(7, 17, 27, 0.1))
        &amp;:last-child
          border-none() 
          margin-bottom: 0
        .icon
          flex: 0 0 57px
          margin-right: 10px
        .content
          flex: 1 //flex布局等分剩下空间
          .name
            margin: 2px 0 8px 0
            height: 14px
            line-height: 14px
            font-size: 14px
            color: rgb(7, 17, 27)
          .desc, .extra
            line-height: 10px
            font-size: 10px
            color: rgb(147, 153, 159)
          .desc
            margin-bottom: 8px
            line-height: 12px
          .extra
            .count
              margin-right: 12px
          .price
            font-weight: 700
            line-height: 24px
            .now
              margin-right: 8px
              font-size: 14px
              color: rgb(240, 20, 20)
            .old
              text-decoration: line-through
              font-size: 10px
              color: rgb(240, 20, 20)
        .cartcontrol-wrapper
            position: absolute
            right: 0
            bottom: 12px   
&lt;/style&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/关于购物车添加按钮的动画/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/关于购物车添加按钮的动画/" itemprop="url">关于购物车添加按钮的动画</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:53:28+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="html代码"><a href="#html代码" class="headerlink" title="html代码"></a>html代码</h2><ul>
<li>生成一个动画小球的div,并且生成五个小球,五个是为了生成一定数量的小球来作为操作使用,按照小球动画的速度,一般来说五个也可以保证有足够的小球数量来运行动画</li>
</ul>
<ul>
<li>动画的内容分别是外层和内层,外层控制动画小球的轨道和方向,内层控制动画小球的运行状态</li>
</ul>
<ul>
<li>动画使用vue的js钩子实现</li>
</ul>
<ul>
<li>因为小球动画只有一个方向(只执行单方向从上到下滚落),所以只用了before-enter,enter,after-enter</li>
</ul>
<ul>
<li><p>用v-show控制小球的可见性,在动画执行期间可见,其余时候隐藏</p>
<pre><code>&lt;div class=&quot;ball-container&quot;&gt;
  &lt;div v-for=&quot;ball in balls&quot;&gt;
  //用了两种方式的动画,css和js钩子
    &lt;transition name=&quot;drop&quot; @before-enter=&quot;beforeDrop&quot; @enter=&quot;dropping&quot; @after-enter=&quot;afterDrop&quot;&gt;
    //外层动画
      &lt;div class=&quot;ball&quot; v-show=&quot;ball.show&quot;&gt;
      //内层动画
        &lt;div class=&quot;inner inner-hook&quot;&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/transition&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre></li>
</ul>
<h2 id="js代码"><a href="#js代码" class="headerlink" title="js代码"></a>js代码</h2><ul>
<li>设置了balls数组来代表五个小球</li>
</ul>
<ul>
<li><p>设置了dropBalls数组正在运行的小球</p>
<pre><code>data(){
     return {
       balls: [
         {show: false},
         {show: false},
         {show: false},
         {show: false},
         {show: false}
       ],
       dropBalls: []
     }
   },
</code></pre></li>
</ul>
<ul>
<li>只要触发了drop事件,不止是drop事件里面的代码会执行,另外几个vue的js监听钩子也会一起按顺序执行</li>
</ul>
<pre><code>- 触发了drop事件


- beforeDrop开始执行


- dropping开始执行


- afterDrop开始执行
</code></pre><ul>
<li>drop事件的触发可以通过点击cartcontrol组件的添加小球按钮addCart事件触发使用$emit,也可以父组件 this.$refs.shopcart.drop(target);直接触发</li>
</ul>
<pre><code>- 这么做的目的是实现,在子组件cartcontrol点击之后,可以将该dom传给父组件goods然后再传给子组件shopcart,(因为目前他们之间的通道就是这样,shopcart子组件并没有导入cartcontrol子组件,所以没有直接通讯)这样就实现了多个组件之间的通讯,从而可以实现需求,例如这里就是实现点击子组件cartcontrol后添加一个动画,将小球滑落到另外一个组件shopcart
</code></pre><ul>
<li><p>$emit是触发当前实例上的事件。附加参数都会传给监听器回调。</p>
<pre><code>methods: {
      drop(el) { 
      //触发一次事件就会将所有小球进行遍历
        for (let i = 0; i &lt; this.balls.length; i++) {
          let ball = this.balls[i];
          if (!ball.show) { //将false的小球放到dropBalls
            ball.show = true;
            ball.el = el; //设置小球的el属性为一个dom对象
            this.dropBalls.push(ball); 
            return;
          }
        }
      },

      beforeDrop(el){ //这个方法的执行是因为这是一个vue的监听事件
        let count = this.balls.length;
        while (count--) {
          let ball = this.balls[count];
          if (ball.show) {
            let rect = ball.el.getBoundingClientRect(); //获取小球的相对于视口的位移(小球高度)
            let x = rect.left - 32;
            let y = -(window.innerHeight - rect.top - 22); //负数,因为是从左上角往下的的方向
            el.style.display = &apos;&apos;; //清空display
            el.style.webkitTransform = `translate3d(0,${y}px,0)`; 
            el.style.transform = `translate3d(0,${y}px,0)`;
            //处理内层动画
            let inner = el.getElementsByClassName(&apos;inner-hook&apos;)[0]; //使用inner-hook类来单纯被js操作
            inner.style.webkitTransform = `translate3d(${x}px,0,0)`;
            inner.style.transform = `translate3d(${x}px,0,0)`;
          }
        }
      },

      dropping(el, done) { //这个方法的执行是因为这是一个vue的监听事件
        /* eslint-disable no-unused-vars */
        let rf = el.offsetHeight; //触发重绘html
        this.$nextTick(() =&gt; { //让动画效果异步执行,提高性能
          el.style.webkitTransform = &apos;translate3d(0,0,0)&apos;;
          el.style.transform = &apos;translate3d(0,0,0)&apos;;
          //处理内层动画
          let inner = el.getElementsByClassName(&apos;inner-hook&apos;)[0]; //使用inner-hook类来单纯被js操作
          inner.style.webkitTransform = &apos;translate3d(0,0,0)&apos;;
          inner.style.transform = &apos;translate3d(0,0,0)&apos;;
          el.addEventListener(&apos;transitionend&apos;, done); //Vue为了知道过渡的完成，必须设置相应的事件监听器。
        });
      },

      afterDrop(el) { //这个方法的执行是因为这是一个vue的监听事件
        let ball = this.dropBalls.shift(); //完成一次动画就删除一个dropBalls的小球
        if (ball) {
          ball.show = false;
          el.style.display = &apos;none&apos;; //隐藏小球
        }
      }
    }
</code></pre></li>
</ul>
<ul>
<li>关于transitionend</li>
</ul>
<ul>
<li>关于drop方法,是实现每一个ball的show属性和el属性处理,并且点击一次会自动将一个小球放到dropBalls数组里面,放到里面就代表的是一个小球已经被开始执行动画,但是由于动画是异步的,所以先主动设置.</li>
</ul>
<ul>
<li>关于getBoundingClientRect(位移的计算是从左上角开始)</li>
</ul>
<pre><code>- 使用getBoundingClientRect获取到当前元素的坐标,然后需要位移的left减去元素的宽获取真正的最终位移x坐标


- 使用getBoundingClientRect获取到当前元素的坐标,然后需要当前屏幕的高度减去元素的top再减去元素本身的高度获取到真正的最终位移y坐标,并且这个是负数,因为是从左上角往下的方向
</code></pre><ul>
<li>关于html重绘</li>
</ul>
<pre><code>- 因为浏览器对于重绘是有要求并且是有队列完成的,这是主要为了性能,虽然动画隐藏了小球display none,但没有触发html重绘,或者说没有立即触发html重绘,所以需要手动


- let rf = el.offsetHeight; 这是一个手动触发html重绘的方法


- 网页性能管理详解


- 高性能JavaScript 重排与重绘
</code></pre><h2 id="css代码"><a href="#css代码" class="headerlink" title="css代码"></a>css代码</h2><pre><code>.ball-container
  .ball
    position: fixed //小球动画必须脱离html布局流
    left: 32px
    bottom: 22px
    z-index: 200 
    transition: all 0.4s cubic-bezier(0.49, -0.29, 0.75, 0.41)
    .inner
      width: 16px
      height: 16px
      border-radius: 50%
      background: rgb(0, 160, 220)
      transition: all 0.4s linear
</code></pre><ul>
<li>关于cubic-bezier(0.49, -0.29, 0.75, 0.41),是动画抛物曲线(贝塞尔曲线)的配置,基于css3实现,<a href="http://cubic-bezier.com/#.17,.67,.83,.67,参考贝塞尔曲线与CSS3动画、SVG和canvas的基情" target="_blank" rel="external">http://cubic-bezier.com/#.17,.67,.83,.67,参考贝塞尔曲线与CSS3动画、SVG和canvas的基情</a> ,至于抛物线放在外层就是为了控制内层的元素的轨道和方向的.</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/头部组件header-vuee/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/头部组件header-vuee/" itemprop="url">头部组件header.vuee</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:53:02+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>弹层制作 vue动画效果配置和弹层css sticky footer原理</li>
</ul>
<pre><code>- 使用css sticky footer技术


- vue的v-for遍历


- vue的v-show和事件监听


- vue动画处理
</code></pre><ul>
<li>header和公告栏制作</li>
</ul>
<pre><code>- text-overflow:ellipsis的使用


- font-size:0和vertical-align的使用


- mixin的运用 stylus相关和1像素边框问题


- 背景图片的虚化


- flex布局的使用
</code></pre><p><img src="http://oncweb6po.bkt.clouddn.com/1878328557-5909e71ab2063_articlex.png" alt=""></p>
<h3 id="html部分"><a href="#html部分" class="headerlink" title="html部分"></a>html部分</h3><pre><code>&lt;template&gt;
  &lt;div class=&quot;header&quot;&gt;
    &lt;div class=&quot;content-wrapper&quot;&gt;
      &lt;div class=&quot;avatar&quot;&gt;
        &lt;img width=&quot;64&quot; height=&quot;64&quot; :src=&quot;seller.avatar&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;content&quot;&gt;
        &lt;div class=&quot;title&quot;&gt;
          &lt;span class=&quot;brand&quot;&gt;&lt;/span&gt;
          &lt;span class=&quot;name&quot;&gt;{{seller.name}}&lt;/span&gt;
        &lt;/div&gt;
        &lt;div class=&quot;description&quot;&gt;
          {{seller.description}} / {{seller.deliveryTime}}分钟送达
        &lt;/div&gt;
        &lt;div v-if=&quot;seller.supports&quot; class=&quot;supports&quot;&gt;
        &lt;!--只列出第一个support的内容--&gt;
          &lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[0].type]&quot;&gt;&lt;/span&gt;
          &lt;span class=&quot;text&quot;&gt;{{seller.supports[0].description}}&lt;/span&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div v-if=&quot;seller.supports&quot; class=&quot;support-count&quot; @click=&quot;showDetail&quot;&gt;
        &lt;span class=&quot;count&quot;&gt;{{seller.supports.length}}个&lt;/span&gt;
        &lt;i class=&quot;icon-keyboard_arrow_right&quot;&gt;&lt;/i&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--绑定showDetail事件--&gt;
    &lt;div class=&quot;bulletin-wrapper&quot; @click=&quot;showDetail&quot;&gt;
      &lt;span class=&quot;bulletin-title&quot;&gt;&lt;/span&gt;&lt;span class=&quot;bulletin-text&quot;&gt;{{seller.bulletin}}&lt;/span&gt;
      &lt;i class=&quot;icon-keyboard_arrow_right&quot;&gt;&lt;/i&gt;
    &lt;/div&gt;
    &lt;div class=&quot;background&quot;&gt;
      &lt;img width=&quot;100%&quot; height=&quot;100%&quot; :src=&quot;seller.avatar&quot;&gt;
    &lt;/div&gt;
    &lt;!--这里使用了vue的动画配置transition--&gt;
    &lt;transition name=&quot;fade&quot;&gt;
      &lt;div v-show=&quot;detailShow&quot; class=&quot;detail&quot;&gt;
      &lt;!--使用clearfix这个class来做css sticky footer--&gt;
        &lt;div class=&quot;detail-wrapper clearfix&quot;&gt;
          &lt;div class=&quot;detail-main&quot;&gt;
            &lt;h1 class=&quot;name&quot;&gt;{{seller.name}}&lt;/h1&gt;
            &lt;div class=&quot;star-wrapper&quot;&gt;
            &lt;!--这里传值给star组件--&gt;
              &lt;star :size=&quot;48&quot; :score=&quot;seller.score&quot;&gt;&lt;/star&gt;
            &lt;/div&gt;
            &lt;div class=&quot;title&quot;&gt;
              &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
              &lt;div class=&quot;text&quot;&gt;优惠信息&lt;/div&gt;
              &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;!--列出全部的support的内容--&gt;
            &lt;ul v-if=&quot;seller.supports&quot; class=&quot;supports&quot;&gt;
              &lt;li class=&quot;support-item&quot; v-for=&quot;(item,index) in seller.supports&quot;&gt;
                &lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[index].type]&quot;&gt;&lt;/span&gt;
                &lt;span class=&quot;text&quot;&gt;{{seller.supports[index].description}}&lt;/span&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
            &lt;div class=&quot;title&quot;&gt;
              &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
              &lt;div class=&quot;text&quot;&gt;商家公告&lt;/div&gt;
              &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;bulletin&quot;&gt;
              &lt;p class=&quot;content&quot;&gt;{{seller.bulletin}}&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;!--绑定hideDetail事件--&gt;
        &lt;div class=&quot;detail-close&quot; @click=&quot;hideDetail&quot;&gt;
          &lt;i class=&quot;icon-close&quot;&gt;&lt;/i&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/transition&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><h2 id="js部分"><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h2><ul>
<li><p>星星组件参看:star.vue</p>
<pre><code>&lt;script&gt;
  import star from &apos;../star/star.vue&apos;; //导入星星组件

  export default{
    props: {
      seller: { //将seller对象传给组件
        type: Object //这是vue的prop验证属性的写法
      }
    },
    data(){
      return { //设置一个变量来控制显示隐藏,vue直接会关联到dom
        detailShow: false 
      }
    },
    methods: {
      showDetail(){
        this.detailShow = true;  //变量控制显示公告详情页
      }
    },
    created(){ //主要看这个classMap
      this.classMap = [&apos;decrease&apos;, &apos;discount&apos;, &apos;special&apos;, &apos;invoice&apos;, &apos;guarantee&apos;];
    },
    components: {
      &apos;star&apos;: star
    }
  }
&lt;/script&gt;
</code></pre></li>
</ul>
<p>这里需要注意的是:</p>
<blockquote>
<p>使用一个classMap的映射方法来实现数字和类型之间的转换</p>
</blockquote>
<p>元数据supports是一个数组:</p>
<pre><code>&quot;supports&quot;: [
      {
        &quot;type&quot;: 0,
        &quot;description&quot;: &quot;在线支付满28减5&quot;
      },
      {
        &quot;type&quot;: 1,
        &quot;description&quot;: &quot;VC无限橙果汁全场8折&quot;
      },
      {
        &quot;type&quot;: 2,
        &quot;description&quot;: &quot;单人精彩套餐&quot;
      },
      {
        &quot;type&quot;: 3,
        &quot;description&quot;: &quot;该商家支持发票,请下单写好发票抬头&quot;
      },
      {
        &quot;type&quot;: 4,
        &quot;description&quot;: &quot;已加入“外卖保”计划,食品安全保障&quot;
      }
    ],
</code></pre><p>然后页面需要根据不同的type来显示不同的description,并且还要显示不同的图片</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/551996820-5909e7e2c07dd_articlex.png" alt=""></p>
<p>这就需要做一个关联,将数组的值跟图片关联起来,而图片的关联是根据class来识别的,从而可以实现数组的方式来调用对应的图片.</p>
<pre><code>&lt;!--这是css里面的--&gt;
            &amp;.decrease
              bg-image(&apos;decrease_1&apos;)
            &amp;.discount
              bg-image(&apos;discount_1&apos;)
            &amp;.guarantee
              bg-image(&apos;guarantee_1&apos;)
            &amp;.invoice
              bg-image(&apos;invoice_1&apos;)
            &amp;.special
              bg-image(&apos;special_1&apos;)
</code></pre><p>通过做一个对应关系</p>
<pre><code>this.classMap = [&apos;decrease&apos;, &apos;discount&apos;, &apos;special&apos;, &apos;invoice&apos;, &apos;guarantee&apos;];
//classMap数组的顺序就对应supports数组的顺序
//例如supports数组的第一个元素就对应decrease,而decrease又对应到.decrease的class
classMap[seller.supports[0].type] //seller.supports[0].type就是0,然后classMap的第0个就是decrease,就能够指向到.decrease
</code></pre><p>这里只需要用数组第一个元素即可</p>
<pre><code>&lt;div v-if=&quot;seller.supports&quot; class=&quot;supports&quot;&gt;
    &lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[0].type]&quot;&gt;&lt;/span&gt;
    &lt;span class=&quot;text&quot;&gt;{{seller.supports[0].description}}&lt;/span&gt;
&lt;/div&gt;
</code></pre><p>这里是用到全部的元素</p>
<pre><code>&lt;ul v-if=&quot;seller.supports&quot; class=&quot;supports&quot;&gt;
    &lt;li class=&quot;support-item&quot; v-for=&quot;(item,index) in seller.supports&quot;&gt;
        &lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[index].type]&quot;&gt;&lt;/span&gt;
        &lt;span class=&quot;text&quot;&gt;{{seller.supports[index].description}}&lt;/span&gt;
    &lt;/li&gt;
&lt;/ul&gt;
</code></pre><h3 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h3><ul>
<li>考虑到行内元素的不一致的对齐,需要大量使用line-height和vertical-align</li>
</ul>
<ul>
<li>font-size为0,为了去掉行内元素的间隙,这个可以继承,所以需要在子孙元素里面再单独设置font-size</li>
</ul>
<ul>
<li>对于text-overflow:ellipsis的长度取决于块的长度</li>
</ul>
<ul>
<li><span class="bulletin-title" \=""><span class="bulletin-text" \=""> 用合并代替换行来取消多余字符,这种情况也是可以避免设置font-size为0</span></span></li>
</ul>
<ul>
<li>使用vertical-align :top之后还需要margin-top :7px,在没办法完全对齐的情况下使用</li>
</ul>
<ul>
<li>clearfix的css sticky footer部分需要参看:vue动画效果配置和弹层css sticky footer原理</li>
</ul>
<pre><code>&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;
  @import &quot;../../common/stylus/mixin.styl&quot; //导入minxin

  .header
    position relative //这里的相对定位是为了让下面的绝对定位做参考
    overflow: hidden
    color: #ffffff
    background: rgba(7, 17, 27, 0.5)
    .content-wrapper
      padding: 24px 12px 18px 24px
      font-size: 0 //这里为0是为了去掉行内元素的间隙,这个可以继承,所以需要在子孙元素里面再单独设置font-size
      position: relative //这里的相对定位是为了让下面的绝对定位做参考
      .avatar
        display: inline-block
        vertical-align: top
        img
          border-radius: 2px
      .content
        display: inline-block
        margin-left: 16px
        .title
          margin: 2px 0 8px 0
          .brand
            display: inline-block
            vertical-align: top
            width: 30px
            height: 18px
            bg-image(&apos;brand&apos;) //这里使用了一个图片的mixin
            background-size: 30px 18px
            background-repeat: no-repeat
          .name
            margin-left: 6px
            font-size: 16px
            line-height: 18px
            font-weight: bold
        .description
          margin-bottom: 10px
          line-height: 12px
          font-size: 12px
        .supports
          .icon
            display: inline-block
            vertical-align: top
            width: 12px
            height: 12px
            margin-right: 4px
            background-size: 12px 12px
            background-repeat: no-repeat
            &amp;.decrease //这里就是配合classMap进行图片切换的
              bg-image(&apos;decrease_1&apos;) //这是图片的mixin,在mixin.styl里面可以看到
            &amp;.discount
              bg-image(&apos;discount_1&apos;)
            &amp;.guarantee
              bg-image(&apos;guarantee_1&apos;)
            &amp;.invoice
              bg-image(&apos;invoice_1&apos;)
            &amp;.special
              bg-image(&apos;special_1&apos;)
          .text
            line-height: 12px
            font-size: 10px
      .support-count
        position: absolute
        right: 12px
        bottom: 14px
        padding: 0 8px
        height: 24px
        line-height: 24px
        border-radius: 14px
        background: rgba(0, 0, 0, 0.2)
        text-align: center
        .count
          vertical-align: top //考虑到行内元素的不一致的对齐,需要大量使用line-height和vertical-align
          font-size: 10px
        .icon-keyboard_arrow_right
          margin-left: 2px
          line-height: 24px
          font-size: 10px
    .bulletin-wrapper
      position: relative //做相对定位,给icon-keyboard_arrow_right绝对定位做参照
      height: 28px
      line-height: 28px
      padding: 0 22px 0 12px
      white-space: nowrap
      overflow: hidden
      text-overflow: ellipsis //这里是字数太长的省略处理
      background: rgba(7, 17, 27, 0.2)
      .bulletin-title
        display: inline-block
        vertical-align: top
        margin-top: 8px
        width: 22px
        height: 12px
        bg-image(&apos;bulletin&apos;)
        background-size: 22px
      .bulletin-text
        vertical-align: top
        margin: 0 4px
        font-size: 10px
        font-weight: 200
      .icon-keyboard_arrow_right
        position: absolute
        font-size: 10px
        right: 12px
        top: 8px
    .background //这里使用的是图片做背景,所以需要做下面这些处理
      position absolute //背景图片需要绝对定位
      top: 0 //设置位置
      left: 0
      width: 100% //设置大小
      height: 100%
      z-index: -1 //将背景图片设置里层,避免突出位置看到外露部分
      filter: blur(10px) //背景图片虚化
    .detail
      position: fixed //弹出层,所以用fixed
      z-index: 100 //需要设置z-index保持一定的高度
      top: 0
      left: 0
      width: 100%
      height: 100%
      overflow: auto //加overflow hidden来把多余的背景阴影去掉
      opacity: 1 //这是动画设置
      background: rgba(7, 17, 27, 0.8)
      &amp;.fade-enter-active, &amp;.fade-leave-active //vue的动画需要参考vue动画配置理解
        transition: all 0.5s
      &amp;.fade-enter, &amp;.fade-leave-active
        opacity: 0
        background: rgba(7, 17, 27, 0)
      .detail-wrapper
        width: 100%
        min-height: 100% //因为不知道有多少内容,所以用min-height
        .detail-main
          margin-top: 64px
          padding-bottom: 64px //预留下面close按钮的位置,所以下内边距顶起
          .name
            line-height: 16px
            text-align: center
            font-size: 16px
            font-weight: 700
          .star-wrapper
            margin-top: 18px
            padding: 2px 0
            text-align center
          .title
            display: flex //使用flex布局等分详情页优惠界面
            width: 80%
            margin: 28px auto 24px auto
            .line
              flex: 1 //使用1的比例的flex块
              position: relative //这里使用相对布局加top对齐,可以也可以margin-bottom
              top: -6px
              border-bottom: 1px solid rgba(255, 255, 255, 0.2) //使用border生成线,因为使用的是div
            .text
              padding: 0 12px
              font-size: 14px
              font-weight 700
          .supports
            width: 80%
            margin: 0 auto
            .support-item
              padding: 0 12px
              margin-bottom: 12px
              font-size: 0
              &amp;:last-child
                margin-bottom: 0
              .icon
                display: inline-block
                width: 16px
                height: 16px
                vertical-align: top
                margin-right: 6px
                background-size: 16px 16px
                background-repeat: no-repeat
                //通过对应不同的class来对应不同的图片
                &amp;.decrease
                  bg-image(&apos;decrease_2&apos;)
                &amp;.discount
                  bg-image(&apos;discount_2&apos;)
                &amp;.guarantee
                  bg-image(&apos;guarantee_2&apos;)
                &amp;.invoice
                  bg-image(&apos;invoice_2&apos;)
                &amp;.special
                  bg-image(&apos;special_2&apos;)
              .text
                line-height: 16px
                font-size: 12px
          .bulletin
            width: 80%
            margin: 0 auto
            .content
              padding: 0 12px
              line-height: 24px
              font-size: 12px
      .detail-close
        position: relative
        width: 32px
        height: 32px
        margin: -64px auto 0 auto //使用之前预留了的位置
        clear: both
        font-size: 32px
&lt;/style&gt;
</code></pre><p>备注:</p>
<ol>
<li>text-overflow :ellipsis显示在底部.不是中间,是浏览器的显示处理不同关于文字内容溢出用点点点-省略号表示</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/星星组件star-vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/星星组件star-vue/" itemprop="url">星星组件star.vue</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:52:39+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>整个流程是:</p>
<ol>
<li>绑定星星类型的class(48,36,24尺寸),使用starType</li>
<li>使用class来显示星星,有3种类型,全星,半星,无星,使用star-item代表星星本身,然后分别使用on,off,half代表三种不同类型的星星</li>
<li>一个span代表一个星星项目,并且使用v-for循环将星星项目输出</li>
</ol>
<p>组合出来的星星html就类似这样</p>
<pre><code>&lt;div class=&quot;star star-48&quot;&gt;
&lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;star-item on&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;star-item half&quot;&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre><h3 id="html部分"><a href="#html部分" class="headerlink" title="html部分"></a>html部分</h3><pre><code>&lt;template&gt;
  &lt;div class=&quot;star&quot; :class=&quot;starType&quot;&gt;
    &lt;span v-for=&quot;itemClass in itemClasses&quot; :class=&quot;itemClass&quot; class=&quot;star-item&quot;&gt;&lt;/span&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre><h3 id="js部分"><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h3><ul>
<li>设置常量是为了方便解耦</li>
</ul>
<ul>
<li>星星计算比较巧妙(根据分数转换为星星数)</li>
</ul>
<pre><code>- 对于分数score进行2然后向下取整,然后再除以2,是为了获取所有星星的数量,并且这个数量是0.5倍数的,例如4.6 2就是9.2,然后向下取整是9,然后再除以2就是4.5,那么就可以得到一个0.5倍数的星星数,可以转换为4个全星+一个半星


- 对于非整数的星星算作是半个星星,需要知道是否有存在这种情况,所以分数score%1 ,例如8 % 1是0, 8.5 % 1就不是0,并且这个半星只会出现一次,因为半星状态就只要一个


- 没有星星的部分是要补全的,这里使用while循环来处理这种情况

        &lt;script&gt;
          //设置常量
          const LENGTH = 5;
          const CLS_ON = &apos;on&apos;;
          const CLS_HALF = &apos;half&apos;;
          const CLS_OFF = &apos;off&apos;;

          export default{
            props: {
              size: { //传入的size变量
                type: Number //设置变量类型
              },
              score: { //传入的score变量
                type: Number
              }
            },
            computed: {
              starType(){ //通过计算属性,返回组装过的类型,用来对应class类型
                return &apos;star-&apos; + this.size;
              },
              itemClasses(){
                let result = []; //返回的是一个数组,用来遍历输出星星
                let score = Math.floor(this.score * 2) / 2; //计算所有星星的数量
                let hasDecimal = score % 1 !== 0; //非整数星星判断
                let integer = Math.floor(score); //整数星星判断
                for (let i = 0; i &lt; integer; i++) { //整数星星使用on
                  result.push(CLS_ON);//一个整数星星就push一个CLS_ON到数组
                }
                if (hasDecimal) { //非整数星星使用half
                  result.push(CLS_HALF);//类似
                }
                while (result.length &lt; LENGTH) { //余下的用无星星补全,使用off
                  result.push(CLS_OFF);//类似
                }
                return result;
              }
            }
          }
        &lt;/script&gt;
</code></pre><h3 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h3><ul>
<li>引入mixin.styl是为了使用bg-image的mixin,因为之前做了一个mixin是专门处理2x和3x图片的转换</li>
</ul>
<ul>
<li>因为这里有3种类型的星星图片,分别是48尺寸,36尺寸,24尺寸,所以对于每一个类别的图片分别使用一种class做对应</li>
</ul>
<ul>
<li><p>每一种星星的尺寸都是有一种相对应的图片的,例如48尺寸的星星就会有,并且图片放在相对应的vue文件目录下</p>
<pre><code>star48_half@2x.png
star48_half@3x.png
star48_off@2x.png
star48_off@3x.png
star48_on@2x.png
star48_on@3x.png
</code></pre></li>
</ul>
<hr>
<pre><code>&lt;style lang=&quot;stylus&quot; rel=&quot;stylesheet/stylus&quot;&gt;
  @import &quot;../../common/stylus/mixin.styl&quot; //引入mixin文件

  .star
    .star-item
      display: inline-block
      background-repeat: no-repeat
    &amp;.star-48 //48尺寸的星星
      .star-item //每一个星星的基本css信息
        width: 20px
        height: 20px
        margin-right: 22px //每一个星星dom都有外边距
        background-size: 20px 20px
        &amp;:last-child //最后一个的外边距就是0
          margin-right: 0
        &amp;.on //全星状态的class
          bg-image(&apos;star48_on&apos;)
        &amp;.half //半星状态的class
          bg-image(&apos;star48_half&apos;)
        &amp;.off //无星状态的class
          bg-image(&apos;star48_off&apos;)
    &amp;.star-36
      .star-item
        width: 15px
        height: 15px
        margin-right: 6px
        background-size: 15px 15px
      &amp;:last-child
        margin-right: 0
      &amp;.on
        bg-image(&apos;star36_on&apos;)
      &amp;.half
        bg-image(&apos;star36_half&apos;)
      &amp;.off
        bg-image(&apos;star36_off&apos;)
    &amp;.star-24
      .star-item
        width: 10px
        height: 10px
        margin-right: 3px
        background-size: 10px 10px
      &amp;:last-child
        margin-right: 0
      &amp;.on
        bg-image(&apos;star24_on&apos;)
      &amp;.half
        bg-image(&apos;star24_half&apos;)
      &amp;.off
        bg-image(&apos;star24_off&apos;)
&lt;/style&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/stylus相关和1像素边框问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/stylus相关和1像素边框问题/" itemprop="url">stylus相关和1像素边框问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:52:19+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1像素边框问题"><a href="#1像素边框问题" class="headerlink" title="1像素边框问题"></a>1像素边框问题</h2><p>1像素边框问题其实就是Dpr的比例问题,例如 Retina屏设置1px边框，实际显示2px,因为Dpr是2,所以会显示为2px</p>
<p>目前这里用的是伪元素 + transform 实现:</p>
<p>伪元素:总结伪类与伪元素</p>
<pre><code>::after 在某元素之后插入某些内容
::before 在某元素之前插入某些内容
</code></pre><blockquote>
<p>原理是利用 :before 或者 :after 重做 border,并且根据媒体查询设置不同的缩放比例(transform 的 scale)<br>具体操作会在stylus里面实现</p>
</blockquote>
<h2 id="stylus相关"><a href="#stylus相关" class="headerlink" title="stylus相关"></a>stylus相关</h2><ul>
<li>使用stylus的写法,通过缩进表示层次与嵌套关系</li>
</ul>
<pre><code>- 使用mixins方法来更方便的组件化css,相关写法可以参考:官网的mixins
</code></pre><p>创建/sell/src/common/stylus这个目录,用来存放stylus相关的文件</p>
<pre><code>src/common/stylus
├── base.styl
├── icon.styl
├── index.styl
└── mixin.styl
</code></pre><p>以下分别是四个文件的代码(名字只是为了区分不同的作用):</p>
<h3 id="base-styl"><a href="#base-styl" class="headerlink" title="base.styl"></a>base.styl</h3><pre><code>&lt;!--这里是对于使用reset.css之后的一些自定义的默认的css初始化--&gt;
&lt;!--字体是一些移动端比较流行的字体,所以这里使用--&gt;
&lt;!--其他都是为了方便开发,避免css的属性继承影响模块的代码--&gt;
body, html
  line-height: 1
  font-weight: 200
  &lt;!--设置一些移动端的常用的字体--&gt;
  font-family: &apos;PingFang SC&apos;, &apos;STHeitiSc-Light&apos;, &apos;Helvetica-Light&apos;, Arial, sans-serif
&lt;!--根据媒体查询@media设置不同的缩放比例(transform 的 scale)来修复1像素边框的问题--&gt;
@media (-webkit-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)
  .border-1px
  &lt;!--使用伪元素::after--&gt; 
    &amp;::after 
    &lt;!--dpr是1.5的时候缩放0.7倍--&gt;
      -webkit-transform: scaleY(0.7) 
      transform: scaleY(0.7)

@media (-webkit-min-device-pixel-ratio: 2),(min-device-pixel-ratio: 2)
  .border-1px
    &amp;::after
    &lt;!--dpr是2的时候缩放0.5倍--&gt;
      -webkit-transform: scaleY(0.5) 
      transform: scaleY(0.5)
</code></pre><ul>
<li>这里的修复1像素边框问题会拆分为2个部分,一个部分是这里的base.styl里面处理缩放,另外一部分是在mixin.styl里面处理重做border</li>
</ul>
<ul>
<li>这里是一个base模块文件,只保留了基本的共用的css,需要结合其他的css文件(stylus)来合并理解</li>
</ul>
<ul>
<li>dpr一般是1或者2,1.5只是为了更精细的去适配1和2之间的手机型号</li>
</ul>
<h3 id="mixin-styl"><a href="#mixin-styl" class="headerlink" title="mixin.styl"></a>mixin.styl</h3><pre><code>//这里是负责1像素边框问题
border-1px($color) //stylus的mixins语法支持传入变量
  position: relative //创建相对定位布局,为after和before的border的绝对布局做定位
  &amp;::after //使用伪元素::after,在元素之后插入内容
    display: block
    position: absolute
    left: 0
    bottom: 0
    width: 100% //需要横向撑开边框宽度
    border-top: 1px solid $color //因为是在元素之后插入,所以是用上边框
    content: &apos; &apos; //after或者before使用的时候,不传入东西也要填一个空字符串

//这里是负责图片的不同dpr下显示高清问题
bg-image($url) //这是图片的mixin,也是类似,不过这里是图片根据dpr来进行适配
  background-image: url($url + &quot;@2x.png&quot;)
  @media (-webkit-min-device-pixel-ratio: 3),(min-device-pixel-ratio: 3)
    background-image: url($url + &quot;@3x.png&quot;)
</code></pre><ul>
<li>这里的border-1px($color) 就是真正处理1像素边框问题的关键,通过伪元素after重做border,并且支持传入颜色变了$color来自定义颜色</li>
</ul>
<ul>
<li>这里的bg-image($url) 是负责处理图片在不同dpr下显示的问题,原来跟1像素边框问题差不多,不过这里不需要重做,只是根据不同的media query来调用不同的图片显示,而这些图片是需要放在相对于的文件夹的,在这个项目的话,是放在.vue文件的文件夹下.</li>
</ul>
<h3 id="icon-styl"><a href="#icon-styl" class="headerlink" title="icon.styl"></a>icon.styl</h3><p>这个其实是用icomoon生成的icon样式文件,通过将小图片转为字体,然后通过css样式调用,这样做的目的可以减少小图片的http请求,也方便管理和使用这些小图片,例如可以直接使用某个图片的class就可以调用该图片</p>
<pre><code>&lt;!--这个其实就是之前图标字体生成的css文件改过来的--&gt;
&lt;!--因为使用webpack打包的关系,需要修改一下url路径,这个按照当前目录查找到文件就可以了--&gt;
@font-face
  font-family: &apos;sell-ico&apos;
  src: url(&apos;../fonts/sell-ico.eot?gr00o7&apos;)
  src: url(&apos;../fonts/sell-ico.eot?gr00o7#iefix&apos;) format(&apos;embedded-opentype&apos;),
    url(&apos;../fonts/sell-ico.ttf?gr00o7&apos;) format(&apos;truetype&apos;),
    url(&apos;../fonts/sell-ico.woff?gr00o7&apos;) format(&apos;woff&apos;),
    url(&apos;../fonts/sell-ico.svg?gr00o7#sell-ico&apos;) format(&apos;svg&apos;)
  font-weight: normal
  font-style: normal

[class^=&quot;icon-&quot;], [class*=&quot; icon-&quot;]
  /* use !important to prevent issues with browser extensions that change fonts */
  font-family: &apos;sell-ico&apos; !important
  speak: none
  font-style: normal
  font-weight: normal
  font-variant: normal
  text-transform: none
  line-height: 1

  /* Better Font Rendering =========== */
  -webkit-font-smoothing: antialiased
  -moz-osx-font-smoothing: grayscale

.icon-arrow_lift:before
  content: &quot;\e900&quot;

.icon-thumb_up:before
  content: &quot;\e901&quot;

.icon-thumb_down:before
  content: &quot;\e902&quot;

.icon-shopping_cart:before
  content: &quot;\e903&quot;

.icon-favorite:before
  content: &quot;\e904&quot;

.icon-check_circle:before
  content: &quot;\e905&quot;

.icon-close:before
  content: &quot;\e906&quot;

.icon-remove_circle_outline:before
  content: &quot;\e907&quot;

.icon-add_circle:before
  content: &quot;\e908&quot;

.icon-keyboard_arrow_right:before
  content: &quot;\e909&quot;
</code></pre><h3 id="index-styl"><a href="#index-styl" class="headerlink" title="index.styl"></a>index.styl</h3><p>使用一个主的styl来包含所有的stylus文件</p>
<pre><code>@import &quot;./icon&quot; 
@import &quot;./mixin&quot;
@import &quot;./base&quot;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/vue动画效果配置和弹层css-sticky-footer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/vue动画效果配置和弹层css-sticky-footer/" itemprop="url">vue动画效果配置和弹层css sticky footer</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:51:56+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="vue动画效果配置"><a href="#vue动画效果配置" class="headerlink" title="vue动画效果配置"></a>vue动画效果配置</h2><p>有两种方式:</p>
<ul>
<li>一种是css方式</li>
</ul>
<p>需要注意 4 个(CSS)类名在 enter/leave 的过渡中切换:</p>
<ol>
<li>v-enter: 定义进入过渡的开始状态。在元素被插入时生效，在下一个帧移除。</li>
<li>v-enter-active: 定义进入过渡的结束状态。在元素被插入时生效，在 transition/animation 完成之后移除。</li>
<li>v-leave: 定义离开过渡的开始状态。在离开过渡被触发时生效，在下一个帧移除。</li>
<li>v-leave-active: 定义离开过渡的结束状态。在离开过渡被触发时生效，在 transition/animation 完成之后移除。</li>
</ol>
<p>一般的使用方式是:<br>在html里面用transition包裹起来,然后建立一个name,这个name对应css的class名字的前缀,例如这里name是fade,class就是fade前缀命名</p>
<p>html代码</p>
<pre><code>&lt;transition name=&quot;fade&quot;&gt;
&lt;/transition&gt;
</code></pre><p>css代码</p>
<pre><code>&amp;.fade-enter-active, &amp;.fade-leave-active
&amp;.fade-enter, &amp;.fade-leave-active
</code></pre><blockquote>
<p>总的来说:在enter里面会代表状态从没有到有的变化,在leave里面会代表状态从有到没有的变化,在使用的时候可以按照需要使用,需要考虑好动画的变化再开始写代码</p>
</blockquote>
<ul>
<li><p>一种是js钩子的方式</p>
<pre><code>methods: {
  // --------
  // 进入中
  // --------
  beforeEnter: function (el) {
    // ...
  },
  // 此回调函数是可选项的设置
  // 与 CSS 结合时使用
  enter: function (el, done) {
    // ...
    done()
  },
  afterEnter: function (el) {
    // ...
  },
  enterCancelled: function (el) {
    // ...
  },
  // --------
  // 离开时
  // --------
  beforeLeave: function (el) {
    // ...
  },
  // 此回调函数是可选项的设置
  // 与 CSS 结合时使用
  leave: function (el, done) {
    // ...
    done()
  },
  afterLeave: function (el) {
    // ...
  },
  // leaveCancelled 只用于 v-show 中
  leaveCancelled: function (el) {
    // ...
  }
}
</code></pre></li>
</ul>
<p>一般的使用方式是</p>
<pre><code>&lt;transition @before-enter=&quot;beforeDrop&quot; @enter=&quot;dropping&quot; @after-enter=&quot;afterDrop&quot;&gt;
&lt;/transition&gt;
</code></pre><p>通过绑定js方法来实现</p>
<blockquote>
<p>总的来说:js钩子会更加细腻,会在变化的过程中也加入一个钩子管理变化,其他跟css方式动画差不多</p>
</blockquote>
<h2 id="弹层和css-sticky-footer原理"><a href="#弹层和css-sticky-footer原理" class="headerlink" title="弹层和css sticky footer原理"></a>弹层和css sticky footer原理</h2><p>css sticky footer解释:如果页面内容不够长的时候，页脚块粘贴在视窗底部；如果内容足够长时，页脚块会被内容向下推送。</p>
<blockquote>
<p>这里主要使用clearfix这个类的伪类来完成.</p>
</blockquote>
<p>原理简述如下:</p>
<ul>
<li>在IE6, 7下zoom: 1会触发hasLayout，从而使元素闭合内部的浮动。</li>
</ul>
<ul>
<li>在标准浏览器下，.clearfix:after这个伪类会在应用到.clearfix的元素后面插入一个clear: both的块级元素，从而达到清除浮动的作用。</li>
</ul>
<ul>
<li>在需要清除浮动的时候，只要写一个.clearfix就行了，然后在需要清浮动的元素中 添加clearfix类名就好了</li>
</ul>
<ul>
<li>防止Collapsing margins(外边距折叠)</li>
</ul>
<ul>
<li>保证跨浏览器的兼容性</li>
</ul>
<p>相关代码如下:</p>
<pre><code>.clearfix:before, clearfix:after {
    content: &quot;.&quot;;   
    display: block;   
    clear: both;     
    visibility: hidden;
    line-height: 0;    //行高为0
    height: 0;     //高度为0
    font-size:0;    //字体大小为0
}

.clearfix { *zoom:1;}   //这是针对于IE6的，因为IE6不支持:after伪类，这个神奇的zoom:1让IE6的元素可以清除浮动来包裹内部元素。
</code></pre><p>备注:</p>
<ul>
<li>zoom: 1 为了兼容 IE6/7,在IE6, 7下zoom: 1会触发hasLayout，从而使元素闭合内部的浮动。</li>
</ul>
<ul>
<li>:before 用来防止 top-margin collapse 和保证当 IE6/7 应用 zoom:1 时的是视觉一致性</li>
</ul>
<ul>
<li>:after 用来清除浮动</li>
</ul>
<pre><code>- visibility: hidden 可见度设为隐藏。注意它和display:none;是有区别的。visibility:hidden;仍然占据空间，只是看不到而已


- clear: both 清除左右两边浮动


- display: block需要将元素转为块级元素才可以实现效果,inline-block也可以


- content: &quot;.&quot; 内容为“.”就是一个英文的句号而已。也可以不写。


- line-height: 0行高为0,设置这些主要是为了避免一些占用位置或者间隔的问题


- height: 0高度为0,同上


- font-size:0 字体大小为0,同上
</code></pre><blockquote>
<p>另外需要注意的是避免Collapsing margins(外边距压扁)<br>有两种情况会引起 Collapsing margin:</p>
<ul>
<li>父子元素(不一定是直接父子)之间会发生 margin-top 和 margin-bottom 的折叠 (如果之间没有 border、padding、inlne-content、height、min-height、max-height 分割的话)</li>
</ul>
<ul>
<li>邻近元素同时设置margin,前面的margin-bottom 和后面的margin-top融合取最大的</li>
</ul>
<p>所以这里能够实现避免Collapsing margins是因为</p>
<ul>
<li>父子的话,给父元素添加.clearfix</li>
</ul>
<ul>
<li>紧邻的话,给前一个元素添加.clearfix<br>这样主要利用 :before psudo-element 给元素内部前面添加一个空的元素 display:block 保证它是一个BFC(BFC可以隔断外边距折叠)</li>
</ul>
</blockquote>
<h3 id="课程里面使用"><a href="#课程里面使用" class="headerlink" title="课程里面使用"></a>课程里面使用</h3><p>因为clearfix是一个比较常用的class,所以在base.styl里面添加,方便其他组件调用</p>
<pre><code>.clearfix
  display: inline-block
  &amp;:before, &amp;:after
    contain: &apos;&apos;
    height: 0
    line-height: 0
    clear: both
    visibility: hidden
</code></pre><blockquote>
<p>这里没有去兼容ie6,7,因为移动端基本不包含这些浏览器<br>使用inline-block是因为做的是行内块处理</p>
</blockquote>
<p>在Header.vue里面使用</p>
<pre><code>&lt;div class=&quot;detail&quot;&gt;
  &lt;div class=&quot;detail-wrapper clearfix&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;detail-close&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre><ul>
<li>先用一个div包裹其需要做css sticky的内容,如detail的div</li>
</ul>
<ul>
<li>然后footer是detail-close按钮,而需要显示并且要持续撑开的内容块是detail-wrapper,那么在detail-wrapper上添加一个clearfix 的class,就会在这个元素后面使用after的伪类生成内容,从而不断推开footer</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/饿了么教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/饿了么教程/" itemprop="url">饿了么教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:51:19+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h1><h3 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1.需求分析"></a>1.需求分析</h3><p><img src="http://oncweb6po.bkt.clouddn.com/%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90.png" alt=""></p>
<h3 id="2-项目资源准备"><a href="#2-项目资源准备" class="headerlink" title="2.项目资源准备"></a>2.项目资源准备</h3><p>resource文件</p>
<h3 id="3-图标字体制作"><a href="#3-图标字体制作" class="headerlink" title="3.图标字体制作"></a>3.图标字体制作</h3><p>在iconmoon<a href="https://icomoon.io/" target="_blank" rel="external">https://icomoon.io/</a>将resource中的svg文件转为font</p>
<h3 id="4-项目目录设计"><a href="#4-项目目录设计" class="headerlink" title="4.项目目录设计"></a>4.项目目录设计</h3><ol>
<li>vue init webpack 项目名字</li>
<li>cd 文件</li>
<li>npm install</li>
<li>npm run dev</li>
</ol>
<ul>
<li>删除src中asset文件夹<br>  -直接删除会报错，需要把vue.vue中的图片引入注释掉 </li>
<li>创建common文件夹<ul>
<li>创建font文件夹（将前面下载的字体打包中的font移入）</li>
<li>创建js文件夹</li>
<li>创建stylus文件夹（将前面下载的字体打包中的css移入，并改名为icon.styl）</li>
</ul>
</li>
<li>在components中创建header文件夹，文件夹中创建header.vue</li>
</ul>
<h3 id="5-mock数据（模拟后台数据）"><a href="#5-mock数据（模拟后台数据）" class="headerlink" title="5.mock数据（模拟后台数据）"></a>5.mock数据（模拟后台数据）</h3><ol>
<li>在根目录下引入data文件</li>
<li><p>在/build/dev-server.js中</p>
<pre><code>var app = express()

var appData = require(&apos;../data.json&apos;);
var seller = appData.seller;
var goods = appData.goods;
var ratings = appData.ratings;

var apiRoutes = express.Router();

apiRoutes.get(&apos;/seller&apos;,function(req,res){
  res.json({
    erron: 0,
    data : seller
  });
});

apiRoutes.get(&apos;/goods&apos;,function(req,res){
  res.json({
    erron: 0,
    data : goods
  });
});

apiRoutes.get(&apos;/ratings&apos;,function(req,res){
  res.json({
    erron: 0,
    data : ratings
  });
});

app.use(&apos;/api&apos;,apiRoutes);
</code></pre></li>
</ol>
<p>在网址后面加上/api/seller检查</p>
<h1 id="二、页面骨架开发"><a href="#二、页面骨架开发" class="headerlink" title="二、页面骨架开发"></a>二、页面骨架开发</h1><h3 id="1-组件拆分（上）"><a href="#1-组件拆分（上）" class="headerlink" title="1.组件拆分（上）"></a>1.组件拆分（上）</h3><ol>
<li>在static中创建css文件夹，里面引入reset.css</li>
</ol>
<h3 id="2-组件拆分（中）"><a href="#2-组件拆分（中）" class="headerlink" title="2.组件拆分（中）"></a>2.组件拆分（中）</h3><ol>
<li>在header.vue中编写</li>
<li><pre><code>&lt;template&gt;
    &lt;div class=&quot;header&quot;&gt;
        I am header
    &lt;/div&gt;
&lt;/template&gt;

 &lt;script&gt;
    export default {}
&lt;/script&gt;

&lt;style lang=&quot;stylus&quot;&gt;

&lt;/style&gt;
</code></pre></li>
<li><p>在app.vue中的script引入</p>
<pre><code>import header from &apos;./components/header/header.vue&apos;

export default {
  components: {
    &apos;v-header&apos;: header
  }
}
</code></pre></li>
<li><p>下载插件</p>
<pre><code>npm install stylus-loader stylus --save-dev
</code></pre></li>
</ol>
<h3 id="3-组件拆分（下）"><a href="#3-组件拆分（下）" class="headerlink" title="3.组件拆分（下）"></a>3.组件拆分（下）</h3><ol>
<li><p>在app.vue的style中</p>
<pre><code>#app
  .tab
    display:flex
    width:100%
    height:40px
    line-height 40px  
    .tab-item
      flex 1
      text-align center
</code></pre><p>使用flex布局，依赖node_modules中的postcss插件搞定css兼容问题</p>
</li>
</ol>
<h3 id="4-vue-router"><a href="#4-vue-router" class="headerlink" title="4.vue-router"></a>4.vue-router</h3><ol>
<li><p>设置选项卡</p>
<pre><code>&lt;div class=&quot;tab&quot;&gt;
  &lt;div class=&quot;tab-item&quot;&gt;
    &lt;router-link to=&apos;./goods&apos;&gt;商品&lt;/router-link&gt;
  &lt;/div&gt;
  &lt;div class=&quot;tab-item&quot;&gt;
    &lt;router-link to=&apos;./ratings&apos;&gt;评论&lt;/router-link&gt;
  &lt;/div&gt;
  &lt;div class=&quot;tab-item&quot;&gt;
    &lt;router-link to=&apos;./seller&apos;&gt;商家&lt;/router-link&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre></li>
<li><p>在/router/index.js中</p>
<pre><code>import goods from &apos;@/components/goods/goods&apos;
import ratings from &apos;@/components/ratings/ratings&apos;
import seller from &apos;@/components/seller/seller&apos;

export default new Router({
  routes: [
    {
      path: &apos;/&apos;,
        redirect:&apos;/goods&apos;  //设置首页为goods
    },
    {
      path: &apos;/ratings&apos;,
      name: &apos;ratings&apos;,
      component: ratings
    },
    {
      path: &apos;/seller&apos;,
      name: &apos;seller&apos;,
      component: seller
    }
  ]
})
</code></pre></li>
<li>各自编写goods,ratings,seller组件</li>
<li>写css样式</li>
</ol>
<h3 id="5-像素实现"><a href="#5-像素实现" class="headerlink" title="5.像素实现"></a>5.像素实现</h3><p>因为不太会配置estin,会有很多报错，所以不装它。为了实现像素自适应，引入flexible插件，因为稿子宽度为750，所以html基准为750/10，使用px-rem插件（注意配置默认值为75，一般不配置的话为16）</p>
<ol>
<li>在common文件夹引入两个文件</li>
<li><p>在App.vue中引入</p>
<pre><code>window._ = require(&apos;./common/js/flexible.debug&apos;)
window._ = require(&apos;./common/js/flexible_css.debug&apos;)
</code></pre></li>
</ol>
<h3 id="6-实现手机预览"><a href="#6-实现手机预览" class="headerlink" title="6.实现手机预览"></a>6.实现手机预览</h3><p>将localhost改成ip地址，复制地址到草料生成二维码，扫码</p>
<h1 id="三、项目实战-header组件开发"><a href="#三、项目实战-header组件开发" class="headerlink" title="三、项目实战-header组件开发"></a>三、项目实战-header组件开发</h1><h3 id="1-Axios从远程读取数据"><a href="#1-Axios从远程读取数据" class="headerlink" title="1.Axios从远程读取数据"></a>1.Axios从远程读取数据</h3><ol>
<li><p>安装axious</p>
<pre><code>npm install axios --save
</code></pre></li>
<li><p>在所在页面引入axious</p>
<pre><code>import axios from &apos;axios&apos;
</code></pre></li>
<li><p>服务端拉取常用商品数据</p>
<pre><code>created(){[
      axios.get(&apos;/api/seller&apos;).then((response) =&gt; {
        if(response.data.erron === 0){
          this.seller = response.data.data
        }
      })
]}
</code></pre><ul>
<li><p>之前要分好数据（dev-server.js），然后在router的index.js中，加入</p>
<pre><code>mode: &apos;history&apos; 为了去掉地址中的#
</code></pre></li>
</ul>
</li>
</ol>
<h3 id="2-外部组件"><a href="#2-外部组件" class="headerlink" title="2.外部组件"></a>2.外部组件</h3><h5 id="1-将app-vue拉取的数据与header-vue连接"><a href="#1-将app-vue拉取的数据与header-vue连接" class="headerlink" title="(1).将app.vue拉取的数据与header.vue连接"></a>(1).将app.vue拉取的数据与header.vue连接</h5><ol>
<li><v-header :seller="seller"></v-header></li>
<li></li>
<li><p>   export default {<br>  props:{</p>
<pre><code>seller:{
    type:Object
}
</code></pre><p>  },</p>
</li>
</ol>
<h5 id="2-获取数据中图片地址"><a href="#2-获取数据中图片地址" class="headerlink" title="(2).获取数据中图片地址"></a>(2).获取数据中图片地址</h5><pre><code>&lt;img width=&quot;64&quot; height=&quot;64&quot; :src=&quot;seller.avatar&quot;&gt;
</code></pre><h5 id="3-判断2x图还是3x图"><a href="#3-判断2x图还是3x图" class="headerlink" title="(3).判断2x图还是3x图"></a>(3).判断2x图还是3x图</h5><ol>
<li><p>写/src/common/stylus/mixin.styl</p>
<pre><code>bg-image($url)
    background-image: url($url+&quot;@2x.png&quot;)
    @media (-webkit-min-device-pixel-ratio:3),(min-device-pixel-ratio:3)
        background-image: url($url+&quot;@3x.png&quot;)
</code></pre></li>
<li><p>在header.vue引入</p>
<pre><code>@import &quot;../../common/stylus/mixin&quot;
</code></pre></li>
<li>css书写<br> bg-imge(‘decrease’)</li>
</ol>
<h5 id="4-引入图标"><a href="#4-引入图标" class="headerlink" title="(4).引入图标"></a>(4).引入图标</h5><pre><code>@import &quot;../../common/stylus/icon&quot;
</code></pre><p>记得改里面的路径</p>
<h5 id="5-判断是减-折-套…"><a href="#5-判断是减-折-套…" class="headerlink" title="(5).判断是减/折/套…"></a>(5).判断是减/折/套…</h5><ol>
<li><p>绑定class，建立classMap数组</p>
<pre><code>&lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[0].type]&quot;&gt;&lt;/span&gt;

created (){
    this.classMap = [&apos;decrease&apos;,&apos;discount&apos;,&apos;special&apos;,&apos;invoice&apos;,&apos;guarantee&apos;,&apos;special&apos;]
}
</code></pre></li>
<li>用</li>
</ol>
<pre><code>&amp;.decrease
    bg-image(&apos;decrease_1&apos;)
&amp;.discount
    bg-image(&apos;discount_1&apos;)
&amp;.guarantee
    bg-image(&apos;guarantee_1&apos;)
&amp;.invoice
    bg-image(&apos;invoice_1&apos;)
&amp;.special
    bg-image(&apos;special_1&apos;)
</code></pre><h5 id="6-做背景图"><a href="#6-做背景图" class="headerlink" title="(6).做背景图"></a>(6).做背景图</h5><p>最后做背景，用定位定上去</p>
<h3 id="3-详情弹层页"><a href="#3-详情弹层页" class="headerlink" title="3.详情弹层页"></a>3.详情弹层页</h3><h5 id="1-星星评分"><a href="#1-星星评分" class="headerlink" title="(1).星星评分"></a>(1).星星评分</h5><ol>
<li>新建/src/components/star/star.vue</li>
<li><p>将half,on,off等图片放进star文件夹中</p>
<pre><code>&lt;template&gt;
    &lt;div class=&quot;star&quot; :class=&quot;starType&quot;&gt;
        &lt;span v-for=&quot;itemClass in itemClasses&quot; :class=&quot;itemClass&quot; class=&quot;star-item&quot;&gt;&lt;/span&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script type=&apos;text/ecmascript-6&apos;&gt;
    const LENGTH = 5
    const CLS_ON = &apos;on&apos;
    const CLS_HALF = &apos;half&apos;
    const CLS_OFF = &apos;off&apos;

    export default {
        props:{
            size:{
                type:Number
            },
            score:{
                type:Number
            }
        },
        computed:{
            starType(){
                return &apos;star-&apos;+this.size;
            },
            itemClasses(){
                let result = []
                let score = Math.floor(this.score*2)/2
                let hasDecimal = score %1 !== 0;
                let integer = Math.floor(score);
                for(let i = 0;i&lt;integer;i++){
                    result.push(CLS_ON)
                }
                if(hasDecimal){
                    result.push(CLS_HALF)
                }
                while(result.length&lt;LENGTH){
                    result.push(CLS_OFF);
                }
                return result
            }
        }
    }
&lt;/script&gt;

&lt;style lang=&apos;stylus&apos;&gt;
@import &quot;../../common/stylus/mixin&quot;

    .star
        font-size 0
        .star-item
            display inline-block
            background-repeat no-repeat
        &amp;.star-48
            .star-item
                width .533333rem
                height .533333rem
                margin-right .586667rem
                background-size .533333rem .533333rem
                &amp;:last-child
                    margin-right 0
                &amp;.on 
                    bg-image(&apos;star48_on&apos;)
                &amp;.half 
                    bg-image(&apos;star48_half&apos;)
                &amp;.off 
                    bg-image(&apos;star48_off&apos;)
        &amp;.star-36
            .star-item
                width .2rem
                height .2rem
                margin-right .16rem
                background-size .2rem .2rem
                &amp;:last-child
                    margin-right 0
                &amp;.on 
                    bg-image(&apos;star36_on&apos;)
                &amp;.half 
                    bg-image(&apos;star36_half&apos;)
                &amp;.off 
                    bg-image(&apos;star36_off&apos;)
        &amp;.star-24
            .star-item
                width .133333rem
                height .133333rem
                margin-right .08rem
                background-size .133333rem .133333rem
                &amp;:last-child
                    margin-right 0
                &amp;.on 
                    bg-image(&apos;star24_on&apos;)
                &amp;.half 
                    bg-image(&apos;star24_half&apos;)
                &amp;.off 
                    bg-image(&apos;star24_off&apos;)
&lt;/style&gt;
</code></pre></li>
</ol>
<pre><code>用：
&lt;div class=&quot;star-wrapper&quot;&gt;
    &lt;star :size=&apos;48&apos; :score=&apos;seller.score&apos;&gt;&lt;/star&gt;
&lt;/div&gt;
</code></pre><h5 id="2-线-文字-线布局"><a href="#2-线-文字-线布局" class="headerlink" title="(2).线-文字-线布局"></a>(2).线-文字-线布局</h5><p>flex布局</p>
<pre><code>.title
    display flex
    width 80%
    margin .746667rem auto .64rem auto
    .line
        flex 1
        position relative
        top -0.16rem
        border-bottom .013333rem solid rgba(255,255,255,0.2)
    .text
        padding 0 .32rem
        font-weight 700
        font-size .373333rem
</code></pre><h5 id="3-减、折、特、票、保列表的遍历"><a href="#3-减、折、特、票、保列表的遍历" class="headerlink" title="(3).减、折、特、票、保列表的遍历"></a>(3).减、折、特、票、保列表的遍历</h5><pre><code>&lt;ul v-if=&quot;seller.supports&quot; class=&quot;supports&quot;&gt;
    &lt;li class=&quot;support-item&quot; v-for=&quot;(item, index) in seller.supports&quot;&gt;
        &lt;span class=&quot;icon&quot; :class=&quot;classMap[seller.supports[index].type]&quot;&gt;&lt;/span&gt;
        &lt;span class=&apos;text&apos;&gt;{{seller.supports[index].description}}&lt;/span&gt;
    &lt;/li&gt;
&lt;/ul&gt;
</code></pre><h5 id="4-动画"><a href="#4-动画" class="headerlink" title="(4).动画"></a>(4).动画</h5><pre><code>&lt;transition name=&quot;fade&quot;&gt;
    &lt;div transition=&quot;fade&quot; class=&quot;detail&quot;&gt;&lt;/div&gt;
&lt;/transition&gt;

.detail
    background rgba(7,17,27,0.8)
    backdrop-filter blur(.133333rem)
    &amp;.fade-enter-active,&amp;.fade-leave, &amp;.fade-leave-active
        opacity 1
        background rgba(7,17,27,0.8)
        transition all 0.5s
    &amp;.fade-enter
        opacity 0
        background rgba(7,17,27,0)
        transition all 0.5s
</code></pre><p><img src="http://oncweb6po.bkt.clouddn.com/3816457655-58fafc9395966_articlex.png" alt=""></p>
<h5 id="5-Sticky-footers"><a href="#5-Sticky-footers" class="headerlink" title="(5).Sticky footers"></a>(5).Sticky footers</h5><p><strong>问题</strong></p>
<blockquote>
<p>如果页面内容不够长的时候，页脚块粘贴在视窗底部；如果内容足够长时，页脚块会被内容向下推送。</p>
</blockquote>
<p><strong>解决方案</strong></p>
<p><img src="http://oncweb6po.bkt.clouddn.com/FireShot%20Capture%201%20-%20sells%20-%20http___localhost_8080_.png" alt=""></p>
<pre><code>    &lt;div v-show=&apos;detailShow&apos; class=&quot;detail&quot; transition=&quot;fade&quot;&gt;
        &lt;div class=&quot;detail-wrapper clearfix&quot;&gt;
            &lt;div class=&quot;detail-main&quot;&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class=&quot;detail-close&quot; @click=&apos;hideDetail&apos;&gt;
            &lt;i class=&quot;icon-close&quot;&gt;&lt;/i&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    .detail-wrapper
        min-height 100%
        width 100%
        .detail-main
            margin-top 1.706667rem
            padding-bottom .853333rem

    .detail-close
        position relative
        width .853333rem
        height .853333rem
        margin:-1.7067rem auto 0 auto
        clear both

在base.styl中
.clearfix
    display: inline-block
    &amp;:after
        display: block
        content:&quot;.&quot;
        height: 0
        line-height: 0
        clear: both
        visibility: hidden
</code></pre><h5 id="6-点击显示-关闭"><a href="#6-点击显示-关闭" class="headerlink" title="(6).点击显示/关闭"></a>(6).点击显示/关闭</h5><pre><code>&lt;div v-show=&apos;detailShow&apos; class=&quot;detail&quot; transition=&quot;fade&quot;&gt;

&lt;div class=&quot;detail-close&quot; @click=&apos;hideDetail&apos;&gt;


    data() {
        return {
            detailShow:false
        }
    }, 
    methods: {
        showDetail() {
            this.detailShow = true;
        },
        hideDetail() {
            this.detailShow = false;
        }
    },
</code></pre><h1 id="food商品详情页实现"><a href="#food商品详情页实现" class="headerlink" title="food商品详情页实现"></a>food商品详情页实现</h1><h3 id="1-将food组件和goods组件连接在一起"><a href="#1-将food组件和goods组件连接在一起" class="headerlink" title="1.将food组件和goods组件连接在一起"></a>1.将food组件和goods组件连接在一起</h3><ol>
<li><p>在goods template中引用food标签</p>
<pre><code>&lt;food :food=&apos;selectedFood&apos;&gt;&lt;/food&gt;
</code></pre></li>
<li><p>在goods script 中引入food组件</p>
<pre><code>import food from &apos;../food/food&apos;
</code></pre></li>
<li><p>在goods script components中引入food组件</p>
</li>
<li><p>goods组件输出food数据</p>
<pre><code>data(){
    return{
        selectedFood:{}
    }
}
</code></pre></li>
<li><p>在food组件注册属性food</p>
<pre><code>props:{
    food:{
        type:Object
    }
}
</code></pre></li>
</ol>
<h3 id="2-获取点击的物品"><a href="#2-获取点击的物品" class="headerlink" title="2.获取点击的物品"></a>2.获取点击的物品</h3><ol>
<li><p>在商品中绑定点击事件 goods组件</p>
<pre><code>&lt;li @click=&quot;selectFood(food,$event)&quot; v-for=&quot;food in item.foods&quot; class=&quot;food-item&quot;&gt;
</code></pre></li>
<li><p>在goods methods中加selectFood事件</p>
<pre><code>selectFood(food,event){
    if(!event._constructed){ //忽略掉BScroll的事件
        return
    }
    this.selectedFood = food //写入当前选择的food
}
</code></pre></li>
</ol>
<h3 id="3-点击物品弹出层"><a href="#3-点击物品弹出层" class="headerlink" title="3.点击物品弹出层"></a>3.点击物品弹出层</h3><ol>
<li><p>在food组件中添加methods</p>
<pre><code>methods:{
    show(){
        this.showFlag = true
    }
}
</code></pre></li>
<li><p>在food组件中注册showFlag值</p>
<pre><code>data(){
    return{
        showFlag:false
    }
},
</code></pre></li>
<li><p>在goods组件 food标签添加ref属性，连接子组件</p>
<pre><code>ref=&quot;food&quot;
</code></pre></li>
<li><p>在goods组件 selectFood方法中调用子组件show方法</p>
<pre><code>this.$refs.food.show()
</code></pre></li>
</ol>
<h3 id="4-实现弹出层从右到左动画"><a href="#4-实现弹出层从右到左动画" class="headerlink" title="4.实现弹出层从右到左动画"></a>4.实现弹出层从右到左动画</h3><ol>
<li><p>给food组件 template最外层中 加一个<transition\>标签</transition\></p>
<pre><code>&lt;transition name=&apos;move&apos;&gt;&lt;/transition&gt;
</code></pre></li>
</ol>
<p>2.在 food组件 css中</p>
<pre><code>.food
  transform: translate3d(0, 0, 0)
  &amp;.move-enter-active, &amp;.move-leave-active
    transition: all 0.2s linear
  &amp;.move-enter, &amp;.move-leave-active
    transform: translate3d(100%, 0, 0)
</code></pre><h3 id="5-让图片宽高一样的黑魔法"><a href="#5-让图片宽高一样的黑魔法" class="headerlink" title="5.让图片宽高一样的黑魔法"></a>5.让图片宽高一样的黑魔法</h3><pre><code>.image-header
    position relative 
    width 100%
    height 0
    padding-top 100%
    img
        position absolute
        top 0
        left 0
        width 100%
        height 100%
</code></pre><h3 id="6-返回小图标"><a href="#6-返回小图标" class="headerlink" title="6.返回小图标"></a>6.返回小图标</h3><p>可以在外面套给div，里面的i标签用padding定位</p>
<pre><code>.back
    position absolute
    top .266667rem
    left 0
    .icon-arrow_lift
        display block
        padding .266667rem
        font-size .533333rem
        color #ffffff
</code></pre><h3 id="7-隐藏滚动条-food"><a href="#7-隐藏滚动条-food" class="headerlink" title="7.隐藏滚动条(food)"></a>7.隐藏滚动条(food)</h3><ol>
<li><p>引入better.scroll插件</p>
<pre><code>import BScroll from &apos;better-scroll&apos;
</code></pre></li>
<li><p>在最外层div，加注册</p>
<pre><code>ref=&apos;food&apos;
</code></pre></li>
<li><p>在show方法上加</p>
<pre><code>this.$nextTick(()=&gt;{  //在这个函数中调用以防内容还未加载完就执行，获取不到元素的高度导致无法滑动
    if(!this.scroll){
        this.scroll = new BScroll(this.$refs.food,{
            click:true
        })
    }else{
        this.scroll.refresh()
    }
})
</code></pre></li>
</ol>
<h3 id="8-点击购物车，数量加一"><a href="#8-点击购物车，数量加一" class="headerlink" title="8.点击购物车，数量加一"></a>8.点击购物车，数量加一</h3><ol>
<li><p>在methods,addCart()中加</p>
<pre><code>addCart(event){
    if (!event._constructed) {
    return;
    }
    if(!this.food.count){
        Vue.set(this.food,&apos;count&apos;,1) //不能像平常那样this.food.count = 1
    }else{
        this.food.count++
    }
}
</code></pre></li>
<li><p>引入vue</p>
<pre><code>import Vue from &apos;vue&apos;
</code></pre></li>
</ol>
<h3 id="9-分割线"><a href="#9-分割线" class="headerlink" title="9.分割线"></a>9.分割线</h3><p>因为出现次数多，所以直接写一个组件</p>
<h3 id="10-商品评价"><a href="#10-商品评价" class="headerlink" title="10.商品评价"></a>10.商品评价</h3><ol>
<li>编写ratingselect组件</li>
<li><p>加属性</p>
<pre><code>const POSITIVE = 0
const NEGATIVE = 1
const ALL = 2

export default{
    props:{
        ratings:{
            type:Array,
            default(){
                return []
            }
        },
        selectType:{
            type:Number,
            default:ALL
        },
        onlyContent:{
            type:Boolean,
            default:false
        },
        desc:{
            type:Object,
            default(){
                return{
                    all:&apos;全部&apos;,
                    positive:&apos;满意&apos;,
                    negative:&apos;不满意&apos;
                }
            }
        }
    }
}
</code></pre></li>
<li>引入到food组件中（常规方法）</li>
</ol>
<h3 id="11-food组件改ratingselect组件（父组件改子组件数据）"><a href="#11-food组件改ratingselect组件（父组件改子组件数据）" class="headerlink" title="11.food组件改ratingselect组件（父组件改子组件数据）"></a>11.food组件改ratingselect组件（父组件改子组件数据）</h3><ol>
<li><p>data输出数据</p>
<pre><code>data(){
    return{
        selectType:ALL,
        onlyContent:true,
        desc:{
            all:&apos;全部&apos;,
            positive:&apos;推荐&apos;,
            negative:&apos;吐槽&apos;
        }
    }
}
</code></pre></li>
<li><ratingselect\>标签绑定数据<br><br>           <ratingselect :selecttype="selectType" :onlycontent="onlyContent" :desc="desc" :ratings="food.ratings"></ratingselect></ratingselect\></li>
<li><p>别忘了在show()中初始化数据</p>
<pre><code>show(){
    this.selectType = ALL
    this.onlyContent = true
}
</code></pre></li>
</ol>
<h3 id="12-消除间隙，把父元素的font-size设置为0"><a href="#12-消除间隙，把父元素的font-size设置为0" class="headerlink" title="12.消除间隙，把父元素的font-size设置为0"></a>12.消除间隙，把父元素的font-size设置为0</h3><h3 id="13-如何添加active类-选中"><a href="#13-如何添加active类-选中" class="headerlink" title="13.如何添加active类(选中)"></a>13.如何添加active类(选中)</h3><ol>
<li>设置selectType属性</li>
<li>将每个描述与selectType属性链接（desc属性）</li>
<li><p>判断selectType属性</p>
<pre><code>:class=&quot;{&apos;active&apos;:selectType===2}&quot;
</code></pre></li>
</ol>
<h3 id="14-点击-只显示有内容的评价"><a href="#14-点击-只显示有内容的评价" class="headerlink" title="14.点击 只显示有内容的评价"></a>14.点击 只显示有内容的评价</h3><pre><code>:class=&quot;{&apos;on&apos;:onlyContent}&quot;
</code></pre><p>绑定属性</p>
<h3 id="15-点击只显示有内容的评价-切换"><a href="#15-点击只显示有内容的评价-切换" class="headerlink" title="15.点击只显示有内容的评价 切换"></a>15.点击只显示有内容的评价 切换</h3><p>添加toggleContent()方法</p>
<pre><code>toggleContent(event){
    if(!event._constructed){ //better.scroll 会给pc端添加click事件，需要阻止
        return 
    }
    this.onlyContent = !this.onlyContent
    this.$emit(&apos;toggle&apos;)  //与food相关联，将数据传出去
}
</code></pre><h3 id="16-全部-推荐-吐槽-按钮的切换"><a href="#16-全部-推荐-吐槽-按钮的切换" class="headerlink" title="16.全部 推荐 吐槽 按钮的切换"></a>16.全部 推荐 吐槽 按钮的切换</h3><p>在标签中引用</p>
<pre><code>@click=&quot;select(2,$event)&quot;
</code></pre><p>添加 select(type,event)方法</p>
<pre><code>select(type,event){
    if(!event._constructed){
        return
    }
    this.selectType = type
    this.$emit(&apos;select&apos;,type)
}
</code></pre><p>之后会根据css写的样式进行展示</p>
<h3 id="17-可以同时判断两个类"><a href="#17-可以同时判断两个类" class="headerlink" title="17.可以同时判断两个类"></a>17.可以同时判断两个类</h3><pre><code>&lt;span :class=&quot;{&apos;icon-thumb_up&apos;:rating.rateType===0,&apos;icon-thumb_down&apos;:rating.rateType===1}&quot;&gt;&lt;/span&gt;
</code></pre><h3 id="18-实现点击全部-推荐-吐槽，显示该显示的内容"><a href="#18-实现点击全部-推荐-吐槽，显示该显示的内容" class="headerlink" title="18.实现点击全部 推荐 吐槽，显示该显示的内容"></a>18.实现点击全部 推荐 吐槽，显示该显示的内容</h3><h5 id="1-在评论区加上展示的方法"><a href="#1-在评论区加上展示的方法" class="headerlink" title="1.在评论区加上展示的方法"></a>1.在评论区加上展示的方法</h5><pre><code>&lt;li v-show=&quot;needShow(rating.rateType,rating.text)&quot; v-for=&quot;rating in food.ratings&quot;
    class=&quot;rating-item&quot;&gt;
</code></pre><h5 id="2-needShow-type-text"><a href="#2-needShow-type-text" class="headerlink" title="2.needShow(type,text)"></a>2.needShow(type,text)</h5><pre><code>needShow(type, text) {
  if (this.onlyContent &amp;&amp; !text) {
    return false;
  }
  if (this.selectType === ALL) {
    return true;
  } else {
    return type === this.selectType;
  }
}
</code></pre><h5 id="3-实现food组件和ratingselect组件链接"><a href="#3-实现food组件和ratingselect组件链接" class="headerlink" title="3.实现food组件和ratingselect组件链接"></a>3.实现food组件和ratingselect组件链接</h5><ol>
<li><p>ratingselect组件</p>
<pre><code>methods: {
  select(type, event) {
    if (!event._constructed) {
      return;
    }
    this.$emit(&apos;select&apos;, type);
  },
  toggleContent(event) {
    if (!event._constructed) {
      return;
    }
    this.$emit(&apos;toggle&apos;);
  }
}
</code></pre></li>
<li><p>food组件绑定ratingselect组件的方法</p>
<pre><code>&lt;ratingselect @select=&quot;selectRating&quot; @toggle=&quot;toggleContent&quot; :selectType=&quot;selectType&quot;
              :onlyContent=&quot;onlyContent&quot; :desc=&quot;desc&quot;
              :ratings=&quot;food.ratings&quot;&gt;&lt;/ratingselect&gt;
</code></pre></li>
<li><p>写绑定的方法</p>
<p>   selectRating(type) {</p>
<pre><code>this.selectType = type;
this.$nextTick(() =&gt; {
  this.scroll.refresh();
});
</code></pre><p>   },<br>   toggleContent() {</p>
<pre><code>this.onlyContent = !this.onlyContent;
this.$nextTick(() =&gt; {
  this.scroll.refresh();
});
</code></pre><p>   }</p>
</li>
</ol>
<h3 id="19-将时间戳转化为日期格式-yyyy-MM-dd-hh-mm"><a href="#19-将时间戳转化为日期格式-yyyy-MM-dd-hh-mm" class="headerlink" title="19.将时间戳转化为日期格式 yyyy-MM-dd hh:mm"></a>19.将时间戳转化为日期格式 yyyy-MM-dd hh:mm</h3><h5 id="1-filters-把时间戳传到函数里"><a href="#1-filters-把时间戳传到函数里" class="headerlink" title="1.filters 把时间戳传到函数里"></a>1.filters 把时间戳传到函数里</h5><pre><code>&lt;div class=&quot;time&quot;&gt;{{rating.rateTime | formatDate}}&lt;/div&gt;

filters:{
    formatDate(time){
        let date = new Date(time)
        return formatDate(date,&apos;yyyy-MM-dd hh:mm&apos;)
    }
}
</code></pre><h5 id="2-传入formaDate模块，因为用的export-，所以要用"><a href="#2-传入formaDate模块，因为用的export-，所以要用" class="headerlink" title="2.传入formaDate模块，因为用的export ，所以要用{}"></a>2.传入formaDate模块，因为用的export ，所以要用{}</h5><pre><code>import {formatDate} from &apos;../../common/js/date&apos;
</code></pre><h5 id="3-date-js"><a href="#3-date-js" class="headerlink" title="3.date.js"></a>3.date.js</h5><pre><code>export function formatDate(date,fmt){
    if(/(y+)/.test(fmt)){
        fmt = fmt.replace(RegExp.$1,(date.getFullYear()+&apos;&apos;).substr(4-RegExp.$1.length))
    }
    let o = {
        &apos;M+&apos;:date.getMonth() +1,
        &apos;d+&apos;:date.getDate(),
        &apos;h+&apos;:date.getHours(),
        &apos;m+&apos;:date.getMinutes(),
        &apos;s+&apos;:date.getSeconds()
    }
    for(let k in o){
        if(new RegExp(`(${k})`).test(fmt)){
            let str = o[k] + &apos;&apos;
            fmt = fmt.replace(RegExp.$1,(RegExp.$1.length === 1)?str:padLeftZero(str))
        }
    }
    return fmt
}

function padLeftZero(str){
    return (&apos;00&apos;+str).substr(str.length)
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/Vue2-0组件之间通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/Vue2-0组件之间通信/" itemprop="url">Vue2.0组件之间通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:49:38+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>App.vue

&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;

  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &apos;app&apos;,
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre><h3 id="一-我们先来创建中央事件总线，在src-assets-下创建一个eventBus-js-内容如下"><a href="#一-我们先来创建中央事件总线，在src-assets-下创建一个eventBus-js-内容如下" class="headerlink" title="一 .我们先来创建中央事件总线，在src/assets/下创建一个eventBus.js,内容如下"></a>一 .我们先来创建中央事件总线，在src/assets/下创建一个eventBus.js,内容如下</h3><pre><code>import Vue from &apos;Vue&apos;

export default new Vue
</code></pre><blockquote>
<p>eventBus中我们只创建了一个新的Vue实例，以后它就承担起了组件之间通信的桥梁了，也就是中央事件总线。</p>
</blockquote>
<h3 id="二-创建一个firstChild组件，引入eventBus这个事件总线，接着添加一个按钮并绑定一个点击事件"><a href="#二-创建一个firstChild组件，引入eventBus这个事件总线，接着添加一个按钮并绑定一个点击事件" class="headerlink" title="二 . 创建一个firstChild组件，引入eventBus这个事件总线，接着添加一个按钮并绑定一个点击事件"></a>二 . 创建一个firstChild组件，引入eventBus这个事件总线，接着添加一个按钮并绑定一个点击事件</h3><pre><code>&lt;template&gt;
    &lt;div id=&quot;firstChild&quot;&gt;
        &lt;h2&gt;firstChild组件&lt;/h2&gt;
        &lt;button @click=&quot;sendMsg&quot;&gt;向组件传值&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import bus from &apos;../assets/eventBus&apos;

export default {
    methods:{
        sendMsg:function(){
            bus.$emit(&quot;userDefinedEvent&quot;,&quot;this message is from firstChild&quot;)
        }
    }
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre><blockquote>
<p>我们在响应点击事件的sendMsg函数中用$emit触发了一个自定义的userDefinedEvent事件，并传递了一个字符串参数<br>PS:$emit实例方法触发当前实例(这里的当前实例就是bus)上的事件,附加参数都会传给监听器回调。</p>
</blockquote>
<h3 id="三-我们再创建一个secondChild组件，引入eventBus事件总线，并用一个p标签来显示传递过来的值"><a href="#三-我们再创建一个secondChild组件，引入eventBus事件总线，并用一个p标签来显示传递过来的值" class="headerlink" title="三 . 我们再创建一个secondChild组件，引入eventBus事件总线，并用一个p标签来显示传递过来的值"></a>三 . 我们再创建一个secondChild组件，引入eventBus事件总线，并用一个p标签来显示传递过来的值</h3><pre><code>&lt;template&gt;
    &lt;div id=&quot;secondChild&quot;&gt;
        &lt;h2&gt;secondChild组件&lt;/h2&gt;
        &lt;p&gt;从firstChild接收的字符串参数：{{msg}}&lt;/p&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import bus from &apos;../assets/eventBus&apos;

export default {
    data(){
        return{
            msg:&quot;默认值&quot;
        }
    },
    mounted(){
        var self = this
        bus.$on(&quot;userDefinedEvent&quot;,function(msg){
            self.msg = msg
        })
    }
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre><blockquote>
<p>我们在mounted中，监听了userDefinedEvent,并把传递过来的字符串参数传递给了$on监听器的回调函数<br>PS:<br>mounted:是一个Vue生命周期中的钩子函数，简单点说就类似于jquery的ready，Vue会在文档加载完毕后调用mounted函数。<br>$on:监听当前实例上的自定义事件(此处当前实例为bus)。事件可以由$emit触发，回调函数会接收所有传入事件触发函数($emit)的额外参数。</p>
</blockquote>
<h3 id="四-在父组件中，注册这两个组件，并添加这两个组件的标签"><a href="#四-在父组件中，注册这两个组件，并添加这两个组件的标签" class="headerlink" title="四 . 在父组件中，注册这两个组件，并添加这两个组件的标签"></a>四 . 在父组件中，注册这两个组件，并添加这两个组件的标签</h3><pre><code>App.vue
&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;firstChild&gt;&lt;/firstChild&gt;
    &lt;secondChild&gt;&lt;/secondChild&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import firstChild from &apos;./components/firstChild&apos;
import secondChild from &apos;./components/secondChild&apos;
export default {
  name: &apos;app&apos;,
  components:{
    firstChild,
    secondChild
  }
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre><h3 id="保存所有修改的文件，然后打开浏览器窗口，内容如下-css请自行处理"><a href="#保存所有修改的文件，然后打开浏览器窗口，内容如下-css请自行处理" class="headerlink" title="保存所有修改的文件，然后打开浏览器窗口，内容如下(css请自行处理)"></a>保存所有修改的文件，然后打开浏览器窗口，内容如下(css请自行处理)</h3><p><img src="http://oncweb6po.bkt.clouddn.com/1916203-08aff10cb88ecc45.png" alt=""></p>
<h3 id="点击向组件传值按钮，我们可以看到传值成功"><a href="#点击向组件传值按钮，我们可以看到传值成功" class="headerlink" title="点击向组件传值按钮，我们可以看到传值成功"></a>点击向组件传值按钮，我们可以看到传值成功</h3><p><img src="http://oncweb6po.bkt.clouddn.com/1916203-96aa0f4902fe8d63.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://super-wei.xyz/2017/09/09/Vue2-0子父组件通信/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ZhangWei2222">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/person.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZhangWei2222">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/09/Vue2-0子父组件通信/" itemprop="url">Vue2.0子父组件通信</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T17:45:18+08:00">
                2017-09-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://oncweb6po.bkt.clouddn.com/111.png" alt=""></p>
<p>###一.父组件向子组件传值</p>
<ol>
<li>创建子组件，在src/components/文件夹下新建一个Child.vue</li>
<li>Child.vue的中创建props，然后创建一个名为message的属性</li>
</ol>
<p><img src="http://oncweb6po.bkt.clouddn.com/222.png" alt=""></p>
<p>3.在App.vue中注册Child组件，并在template中加入child标签，标签中添加message属性并赋值</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/333.png" alt=""></p>
<p>4.保存修改的文件，查看浏览器</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/444.png" alt=""></p>
<p>5.我们依然可以对message的值进行v-bind动态绑定</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/555.png" alt=""></p>
<p>此时浏览器中</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/666.png" alt=""></p>
<blockquote>
<p>父组件向子组件传值成功<br>总结一下：</p>
<ul>
<li>子组件在props中创建一个属性，用以接收父组件传过来的值</li>
</ul>
<ul>
<li>父组件中注册子组件</li>
</ul>
<ul>
<li>在子组件标签中添加子组件props中创建的属性</li>
</ul>
<ul>
<li>把需要传给子组件的值赋给该属性</li>
</ul>
</blockquote>
<h3 id="二-子组件向父组件传值"><a href="#二-子组件向父组件传值" class="headerlink" title="二.子组件向父组件传值"></a>二.子组件向父组件传值</h3><p>1.在子组件中创建一个按钮，给按钮绑定一个点击事件</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/777.png" alt=""></p>
<p>2.在响应该点击事件的函数中使用$emit来触发一个自定义事件，并传递一个参数</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/888.png" alt=""></p>
<p>3.在父组件中的子标签中监听该自定义事件并添加一个响应该事件的处理方法</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/999.png" alt=""></p>
<p>4.保存修改的文件，在浏览器中点击按钮</p>
<p><img src="http://oncweb6po.bkt.clouddn.com/1010.png" alt=""></p>
<blockquote>
<p>子组件向父组件传值成功<br>总结一下：</p>
<ul>
<li>子组件中需要以某种方式例如点击事件的方法来触发一个自定义事件</li>
</ul>
<ul>
<li>将需要传的值作为$emit的第二个参数，该值将作为实参传给响应自定义事件的方法</li>
</ul>
<ul>
<li>在父组件中注册子组件并在子组件标签上绑定对自定义事件的监听</li>
</ul>
</blockquote>
<p><strong>在通信中，无论是子组件向父组件传值还是父组件向子组件传值，他们都有一个共同点就是有中间介质，子向父的介质是自定义事件，父向子的介质是props中的属性。抓准这两点对于父子通信就好理解了</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/person.jpg"
               alt="ZhangWei2222" />
          <p class="site-author-name" itemprop="name">ZhangWei2222</p>
           
              <p class="site-description motion-element" itemprop="description">Dream high</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/">
                <span class="site-state-item-count">61</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ZhangWei2222</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
